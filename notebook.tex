
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{180811f\_StAn\_Traffic\_Sign\_Classifier\_Simple}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{Self-Driving Car Engineer
Nanodegree}\label{self-driving-car-engineer-nanodegree}

\subsection{Deep Learning}\label{deep-learning}

\subsection{Project: Build a Traffic Sign Recognition
Classifier}\label{project-build-a-traffic-sign-recognition-classifier}

In this notebook, a template is provided for you to implement your
functionality in stages, which is required to successfully complete this
project. If additional code is required that cannot be included in the
notebook, be sure that the Python code is successfully imported and
included in your submission if necessary.

\begin{quote}
\textbf{Note}: Once you have completed all of the code implementations,
you need to finalize your work by exporting the iPython Notebook as an
HTML document. Before exporting the notebook to html, all of the code
cells need to have been run so that reviewers can see the final
implementation and output. You can then export the notebook by using the
menu above and navigating to \n", "\textbf{File -\textgreater{} Download
as -\textgreater{} HTML (.html)}. Include the finished document along
with this notebook as your submission.
\end{quote}

In addition to implementing code, there is a writeup to complete. The
writeup should be completed in a separate file, which can be either a
markdown file or a pdf document. There is a
\href{https://github.com/udacity/CarND-Traffic-Sign-Classifier-Project/blob/master/writeup_template.md}{write
up template} that can be used to guide the writing process. Completing
the code template and writeup template will cover all of the
\href{https://review.udacity.com/\#!/rubrics/481/view}{rubric points}
for this project.

The \href{https://review.udacity.com/\#!/rubrics/481/view}{rubric}
contains "Stand Out Suggestions" for enhancing the project beyond the
minimum requirements. The stand out suggestions are optional. If you
decide to pursue the "stand out suggestions", you can include the code
in this Ipython notebook and also discuss the results in the writeup
file.

\begin{quote}
\textbf{Note:} Code and Markdown cells can be executed using the
\textbf{Shift + Enter} keyboard shortcut. In addition, Markdown cells
can be edited by typically double-clicking the cell to enter edit mode.
\end{quote}

    \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Import all necessary
packages}\label{import-all-necessary-packages}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{import} \PY{n+nn}{pickle}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{utils} \PY{k}{import} \PY{n}{shuffle}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{random}
        \PY{k+kn}{import} \PY{n+nn}{csv}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{from} \PY{n+nn}{textwrap} \PY{k}{import} \PY{n}{wrap}
        \PY{k+kn}{import} \PY{n+nn}{cv2}
        \PY{k+kn}{import} \PY{n+nn}{tensorflow} \PY{k}{as} \PY{n+nn}{tf}
        \PY{k+kn}{from} \PY{n+nn}{tensorflow}\PY{n+nn}{.}\PY{n+nn}{contrib}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{flatten}
        \PY{k+kn}{import} \PY{n+nn}{glob}
        \PY{k+kn}{import} \PY{n+nn}{os}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{image} \PY{k}{as} \PY{n+nn}{mpimg}
        \PY{k+kn}{from} \PY{n+nn}{PIL} \PY{k}{import} \PY{n}{Image} \PY{k}{as} \PY{n}{im}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
C:\textbackslash{}ProgramData\textbackslash{}Anaconda3\textbackslash{}envs\textbackslash{}tensorflow\_GPU\textbackslash{}lib\textbackslash{}site-packages\textbackslash{}h5py\textbackslash{}\_\_init\_\_.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from .\_conv import register\_converters as \_register\_converters

    \end{Verbatim}

    \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Step 0: Load The Data}\label{step-0-load-the-data}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{c+c1}{\PYZsh{} Load pickled data}
        
        \PY{c+c1}{\PYZsh{} TODO: Fill this in based on where you saved the training and testing data}
        
        \PY{c+c1}{\PYZsh{} define input files}
        \PY{n}{training\PYZus{}file} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/traffic\PYZhy{}signs\PYZhy{}data/train.p}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{validation\PYZus{}file} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/traffic\PYZhy{}signs\PYZhy{}data/valid.p}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{testing\PYZus{}file} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/traffic\PYZhy{}signs\PYZhy{}data/test.p}\PY{l+s+s1}{\PYZsq{}}
        
        \PY{c+c1}{\PYZsh{} load inputs from input files}
        \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{training\PYZus{}file}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{f}\PY{p}{:}
            \PY{n}{train} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{f}\PY{p}{)}
        \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{validation\PYZus{}file}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{f}\PY{p}{:}
            \PY{n}{valid} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{f}\PY{p}{)}
        \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{testing\PYZus{}file}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{f}\PY{p}{:}
            \PY{n}{test} \PY{o}{=} \PY{n}{pickle}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{f}\PY{p}{)}
            
        \PY{c+c1}{\PYZsh{} get data from inputs}
        \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{train}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{features}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{train}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        \PY{n}{X\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{valid}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{features}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{valid}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test} \PY{o}{=} \PY{n}{test}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{features}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{test}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        
        \PY{c+c1}{\PYZsh{} check data consistency}
        \PY{k}{assert}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{)}
        \PY{k}{assert}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}valid}\PY{p}{)} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{y\PYZus{}valid}\PY{p}{)}\PY{p}{)}
        \PY{k}{assert}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Step 1: Dataset Summary \&
Exploration}\label{step-1-dataset-summary-exploration}

The pickled data is a dictionary with 4 key/value pairs:

\begin{itemize}
\tightlist
\item
  \texttt{\textquotesingle{}features\textquotesingle{}} is a 4D array
  containing raw pixel data of the traffic sign images, (num examples,
  width, height, channels).
\item
  \texttt{\textquotesingle{}labels\textquotesingle{}} is a 1D array
  containing the label/class id of the traffic sign. The file
  \texttt{signnames.csv} contains id -\textgreater{} name mappings for
  each id.
\item
  \texttt{\textquotesingle{}sizes\textquotesingle{}} is a list
  containing tuples, (width, height) representing the original width and
  height the image.
\item
  \texttt{\textquotesingle{}coords\textquotesingle{}} is a list
  containing tuples, (x1, y1, x2, y2) representing coordinates of a
  bounding box around the sign in the image. \textbf{THESE COORDINATES
  ASSUME THE ORIGINAL IMAGE. THE PICKLED DATA CONTAINS RESIZED VERSIONS
  (32 by 32) OF THESE IMAGES}
\end{itemize}

Complete the basic data summary below. Use python, numpy and/or pandas
methods to calculate the data summary rather than hard coding the
results. For example, the
\href{http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.shape.html}{pandas
shape method} might be useful for calculating some of the summary
results.

    \subsubsection{Provide a Basic Summary of the Data Set Using Python,
Numpy and/or
Pandas}\label{provide-a-basic-summary-of-the-data-set-using-python-numpy-andor-pandas}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Replace each question mark with the appropriate value. }
        \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Use python, pandas or numpy methods rather than hard coding the results}
        
        \PY{c+c1}{\PYZsh{} TODO: Number of training examples}
        \PY{n}{n\PYZus{}train} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        
        \PY{c+c1}{\PYZsh{} TODO: Number of validation examples}
        \PY{n}{n\PYZus{}validation} \PY{o}{=} \PY{n}{X\PYZus{}valid}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        
        \PY{c+c1}{\PYZsh{} TODO: Number of testing examples.}
        \PY{n}{n\PYZus{}test} \PY{o}{=} \PY{n}{X\PYZus{}test}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        
        \PY{c+c1}{\PYZsh{} TODO: What\PYZsq{}s the shape of an traffic sign image?}
        \PY{n}{image\PYZus{}shape} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{shape} \PY{k}{if} \PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{shape} \PY{o}{==} \PY{n}{X\PYZus{}valid}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{shape} \PY{o}{==} \PY{n}{X\PYZus{}test}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{)} \PY{k}{else} \PY{p}{[}\PY{p}{]}
        
        \PY{c+c1}{\PYZsh{} TODO: How many unique classes/labels there are in the dataset.}
        \PY{n}{l\PYZus{}classes} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        \PY{n}{n\PYZus{}classes} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{p}{[}\PY{n}{l\PYZus{}classes}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{label}\PY{p}{)} \PY{k}{for} \PY{n}{label} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}\PY{p}{)} \PY{k}{if} \PY{n}{label} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{l\PYZus{}classes}\PY{p}{]}\PY{p}{)}
        
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of training examples =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{n\PYZus{}train}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of validation examples =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{n\PYZus{}validation}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of testing examples =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{n\PYZus{}test}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Image data shape =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{image\PYZus{}shape}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of classes =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{n\PYZus{}classes}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Number of training examples = 34799
Number of validation examples = 4410
Number of testing examples = 12630
Image data shape = (32, 32, 3)
Number of classes = 43

    \end{Verbatim}

    \subsubsection{Include an exploratory visualization of the
dataset}\label{include-an-exploratory-visualization-of-the-dataset}

    Visualize the German Traffic Signs Dataset using the pickled file(s).
This is open ended, suggestions include: plotting traffic sign images,
plotting the count of each sign, etc.

The \href{http://matplotlib.org/}{Matplotlib}
\href{http://matplotlib.org/examples/index.html}{examples} and
\href{http://matplotlib.org/gallery.html}{gallery} pages are a great
resource for doing visualizations in Python.

\textbf{NOTE:} It's recommended you start with something simple first.
If you wish to do more, come back to it after you've completed the rest
of the sections. It can be interesting to look at the distribution of
classes in the training, validation and test set. Is the distribution
the same? Are there more examples of some classes than others?

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Data exploration visualization code goes here.}
        \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
        
        \PY{c+c1}{\PYZsh{} Visualizations will be shown in the notebook.}
        
        \PY{c+c1}{\PYZsh{} define constants}
        \PY{n}{displayimages} \PY{o}{=} \PY{l+m+mi}{30}
        
        \PY{k}{def} \PY{n+nf}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{images}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{totalimages}\PY{p}{,} \PY{n}{interpolation} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{vmin} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{vmax} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{cmap} \PY{o}{=} \PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} This function plots a set of traffic sign images}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} Inputs}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} images        : list of images}
        \PY{c+c1}{\PYZsh{} labels        : list of image labels}
        \PY{c+c1}{\PYZsh{} totalimages   : total number of images to plot}
        \PY{c+c1}{\PYZsh{} interpolation : interpolation method for imshow()}
        \PY{c+c1}{\PYZsh{} vmin          : vmin for imshow()}
        \PY{c+c1}{\PYZsh{} vmax          : vmax for imshow()}
        \PY{c+c1}{\PYZsh{} cmap          : cmap for imshow()}
            
            \PY{c+c1}{\PYZsh{} define constants}
            \PY{n}{maxhorizontalimages} \PY{o}{=} \PY{l+m+mi}{10}
            \PY{n}{dpi} \PY{o}{=} \PY{l+m+mi}{80}
            \PY{n}{minhorizontalimagesize} \PY{o}{=} \PY{l+m+mi}{6}
            \PY{n}{maxhorizontalimagesize} \PY{o}{=} \PY{l+m+mi}{15}
            \PY{n}{titlebasefontsize} \PY{o}{=} \PY{l+m+mi}{100}
            \PY{n}{titlechars\PYZus{}per\PYZus{}line} \PY{o}{=} \PY{l+m+mi}{18}
            
            \PY{c+c1}{\PYZsh{} initialize variables}
            \PY{n}{horizontalimages} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{totalimages}\PY{p}{,} \PY{n}{maxhorizontalimages}\PY{p}{)}
            \PY{n}{horizontalimagesize} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{maxhorizontalimagesize} \PY{o}{/} \PY{n}{minhorizontalimagesize} \PY{o}{*} \PY{n}{totalimages}\PY{p}{,} \PY{n}{maxhorizontalimagesize}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} create figure with subplot}
            \PY{n}{verticalimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n}{totalimages} \PY{o}{/} \PY{n}{horizontalimages}\PY{p}{)}\PY{p}{)}
            \PY{n}{verticalimagesize} \PY{o}{=} \PY{p}{(}\PY{n}{horizontalimagesize} \PY{o}{*} \PY{p}{(}\PY{n}{verticalimages} \PY{o}{/} \PY{n}{horizontalimages}\PY{p}{)}\PY{p}{)}
            \PY{n}{figure}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{verticalimages}\PY{p}{,} \PY{n}{horizontalimages}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{n}{horizontalimagesize}\PY{p}{,} \PY{n}{verticalimagesize}\PY{p}{)}\PY{p}{,} \PY{n}{dpi} \PY{o}{=} \PY{n}{dpi}\PY{p}{)}
            \PY{n}{figure}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
            \PY{c+c1}{\PYZsh{} figure.subplots\PYZus{}adjust(left=None, bottom=None, right=None, top=None, wspace=None, hspace=None)}
            \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{axes}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{ndarray}\PY{p}{)}\PY{p}{:}
                \PY{n}{axes} \PY{o}{=} \PY{n}{axes}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{axes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{axes}\PY{p}{]}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} plot all images}
            \PY{n}{titlefontsize} \PY{o}{=} \PY{p}{(}\PY{n}{titlebasefontsize} \PY{o}{/} \PY{n}{horizontalimages}\PY{p}{)} \PY{o}{*} \PY{p}{(}\PY{n}{horizontalimagesize} \PY{o}{/} \PY{n}{maxhorizontalimagesize}\PY{p}{)}
            \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{axis} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{axes}\PY{p}{)}\PY{p}{:}
                
                \PY{c+c1}{\PYZsh{} configure axis}
                \PY{n}{axis}\PY{o}{.}\PY{n}{set\PYZus{}axis\PYZus{}off}\PY{p}{(}\PY{p}{)}
                \PY{n}{axis}\PY{o}{.}\PY{n}{get\PYZus{}xaxis}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}visible}\PY{p}{(}\PY{k+kc}{False}\PY{p}{)}
                \PY{n}{axis}\PY{o}{.}\PY{n}{get\PYZus{}yaxis}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}visible}\PY{p}{(}\PY{k+kc}{False}\PY{p}{)}
                
                \PY{c+c1}{\PYZsh{} print label and plot image}
                \PY{k}{if} \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{labels}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{n}{idx}\PY{p}{)}\PY{p}{:}
                    \PY{n}{axis}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{wrap}\PY{p}{(}\PY{n}{labels}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{titlechars\PYZus{}per\PYZus{}line}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{fontsize} \PY{o}{=} \PY{n}{titlefontsize}\PY{p}{)}
                    \PY{n}{axis}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{images}\PY{p}{[}\PY{n}{idx}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{interpolation} \PY{o}{=} \PY{n}{interpolation}\PY{p}{,} \PY{n}{vmin} \PY{o}{=} \PY{n}{vmin}\PY{p}{,} \PY{n}{vmax} \PY{o}{=} \PY{n}{vmax}\PY{p}{,} \PY{n}{cmap} \PY{o}{=} \PY{n}{cmap}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} make sure plot is shown}
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} read description of labels}
        \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{signnames.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{csvfile}\PY{p}{:}
            \PY{n}{reader} \PY{o}{=} \PY{n}{csv}\PY{o}{.}\PY{n}{DictReader}\PY{p}{(}\PY{n}{csvfile}\PY{p}{)}
            \PY{n}{labeldict} \PY{o}{=} \PY{n+nb}{dict}\PY{p}{(}\PY{p}{[}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{int}\PY{p}{(}\PY{n}{row}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ClassId}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{row}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SignName}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} \PY{k}{for} \PY{n}{row} \PY{o+ow}{in} \PY{n}{reader}\PY{p}{]}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} select and plot random images}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Random images:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{indices} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randint}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{n}{displayimages}\PY{p}{)}
        \PY{n}{images} \PY{o}{=} \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{n}{indices}\PY{p}{]}\PY{o}{.}\PY{n}{squeeze}\PY{p}{(}\PY{p}{)}
        \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{n}{labeldict}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{k}{for} \PY{n}{idx} \PY{o+ow}{in} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{indices}\PY{p}{]}\PY{p}{]}
        \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{images}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{displayimages}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} select and plot random images of the same random label}
        \PY{n}{label} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randint}\PY{p}{(}\PY{n+nb}{min}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Random images of the same random label:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labeldict}\PY{p}{[}\PY{n}{label}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{]}\PY{p}{)}
        \PY{n}{images} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{image} \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{image} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)} \PY{k}{if} \PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{==} \PY{n}{label}\PY{p}{)}\PY{p}{]}\PY{p}{)}
        \PY{n}{indices} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randint}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{images}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{displayimages}\PY{p}{)}
        \PY{n}{images} \PY{o}{=} \PY{n}{images}\PY{p}{[}\PY{n}{indices}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}
        \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{n}{labeldict}\PY{p}{[}\PY{n}{label}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{]} \PY{k}{for} \PY{n}{image} \PY{o+ow}{in} \PY{n}{images}\PY{p}{]}
        \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{images}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{displayimages}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} select and plot a high contrast image for each label}
        \PY{n}{labelnums} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n+nb}{min}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
        \PY{n}{contrastimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        \PY{n}{averageimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        \PY{k}{for} \PY{n}{labelnum} \PY{o+ow}{in} \PY{n}{labelnums}\PY{p}{:}
            \PY{n}{labelimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{image} \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{image} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)} \PY{k}{if} \PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{==} \PY{n}{labelnum}\PY{p}{)}\PY{p}{]}\PY{p}{)}
            \PY{n}{grays} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{cv2}\PY{o}{.}\PY{n}{cvtColor}\PY{p}{(}\PY{n}{labelimage}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{COLOR\PYZus{}RGB2GRAY}\PY{p}{)} \PY{k}{for} \PY{n}{labelimage} \PY{o+ow}{in} \PY{n}{labelimages}\PY{p}{]}\PY{p}{)}
            \PY{n}{smalls} \PY{o}{=} \PY{p}{[}\PY{n}{gray}\PY{p}{[}\PY{l+m+mi}{15}\PY{p}{:}\PY{l+m+mi}{18}\PY{p}{,} \PY{l+m+mi}{15}\PY{p}{:}\PY{l+m+mi}{18}\PY{p}{]} \PY{k}{for} \PY{n}{gray} \PY{o+ow}{in} \PY{n}{grays}\PY{p}{]}
            \PY{n}{deviations} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{absolute}\PY{p}{(}\PY{n}{small} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{average}\PY{p}{(}\PY{n}{small}\PY{p}{)}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{small} \PY{o+ow}{in} \PY{n}{smalls}\PY{p}{]}\PY{p}{)}
            \PY{n}{contrastimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{labelimages}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{deviations}\PY{p}{)}\PY{p}{]}\PY{p}{)}
            \PY{n}{averageimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{average}\PY{p}{(}\PY{n}{labelimages}\PY{p}{,} \PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}\PY{p}{)}
        \PY{n}{contrastimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{contrastimages}\PY{p}{)}
        \PY{n}{averageimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{averageimages}\PY{p}{)}
        \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{n}{labeldict}\PY{p}{[}\PY{n}{labelnum}\PY{p}{]} \PY{k}{for} \PY{n}{labelnum} \PY{o+ow}{in} \PY{n}{labelnums}\PY{p}{]}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{High contrast image for each label:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{contrastimages}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{labelnums}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Average image for each label:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{averageimages}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{labelnums}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Random images:

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Random images of the same random label: Speed limit (20km/h)

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
High contrast image for each label:

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Average image for each label:

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{(One could add picture transformations on the X\_train
dataset to improve the
training)}\label{one-could-add-picture-transformations-on-the-x_train-dataset-to-improve-the-training}

    \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Step 2: Design and Test a Model
Architecture}\label{step-2-design-and-test-a-model-architecture}

Design and implement a deep learning model that learns to recognize
traffic signs. Train and test your model on the
\href{http://benchmark.ini.rub.de/?section=gtsrb\&subsection=dataset}{German
Traffic Sign Dataset}.

The LeNet-5 implementation shown in the
\href{https://classroom.udacity.com/nanodegrees/nd013/parts/fbf77062-5703-404e-b60c-95b78b2f3f9e/modules/6df7ae49-c61c-4bb2-a23e-6527e69209ec/lessons/601ae704-1035-4287-8b11-e2c2716217ad/concepts/d4aca031-508f-4e0b-b493-e7b706120f81}{classroom}
at the end of the CNN lesson is a solid starting point. You'll have to
change the number of classes and possibly the preprocessing, but aside
from that it's plug and play!

With the LeNet-5 solution from the lecture, you should expect a
validation set accuracy of about 0.89. To meet specifications, the
validation set accuracy will need to be at least 0.93. It is possible to
get an even higher accuracy, but 0.93 is the minimum for a successful
project submission.

There are various aspects to consider when thinking about this problem:

\begin{itemize}
\tightlist
\item
  Neural network architecture (is the network over or underfitting?)
\item
  Play around preprocessing techniques (normalization, rgb to grayscale,
  etc)
\item
  Number of examples per label (some have more than others).
\item
  Generate fake data.
\end{itemize}

Here is an example of a
\href{http://yann.lecun.com/exdb/publis/pdf/sermanet-ijcnn-11.pdf}{published
baseline model on this problem}. It's not required to be familiar with
the approach used in the paper but, it's good practice to try to read
papers like these.

    \subsubsection{Pre-process the Data Set (normalization, grayscale,
etc.)}\label{pre-process-the-data-set-normalization-grayscale-etc.}

    Minimally, the image data should be normalized so that the data has mean
zero and equal variance. For image data, \texttt{(pixel\ -\ 128)/\ 128}
is a quick way to approximately normalize the data and can be used in
this project.

Other pre-processing steps are optional. You can try different
techniques to see if it improves performance.

Use the code cell (or multiple code cells, if necessary) to implement
the first step of your project.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Preprocess the data here. It is required to normalize the data. Other preprocessing steps could include }
        \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} converting to grayscale, etc.}
        \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
        
        \PY{c+c1}{\PYZsh{} normalize input data}
        \PY{n}{X\PYZus{}train\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{X\PYZus{}train} \PY{o}{/} \PY{l+m+mf}{127.5}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{)}
        \PY{n}{X\PYZus{}valid\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{X\PYZus{}valid} \PY{o}{/} \PY{l+m+mf}{127.5}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{)}
        \PY{n}{X\PYZus{}test\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{X\PYZus{}test} \PY{o}{/} \PY{l+m+mf}{127.5}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} ensure correct label data type}
        \PY{n}{y\PYZus{}train\PYZus{}conv} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
        \PY{n}{y\PYZus{}valid\PYZus{}conv} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
        \PY{n}{y\PYZus{}test\PYZus{}conv} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
\end{Verbatim}


    \subsubsection{Model Architecture}\label{model-architecture}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Define your architecture here.}
        \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
        
        \PY{k}{def} \PY{n+nf}{LeNet}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{bdisplay}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} This function calculates the LeNet logits for input x}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} Inputs}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} x        : input image}
        \PY{c+c1}{\PYZsh{} bdisplay : boolean for \PYZsq{}display information\PYZsq{}}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} Outputs}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} logits : probabilities of individual classes in input image}
            
            \PY{c+c1}{\PYZsh{} Arguments used for tf.truncated\PYZus{}normal, randomly defines variables for the weights and biases for each layer}
            \PY{n}{mu} \PY{o}{=} \PY{l+m+mi}{0}
            \PY{n}{sigma} \PY{o}{=} \PY{l+m+mf}{0.1}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Layer 1: Convolutional. Input = 32x32x3. Output = 28x28x6.}
            \PY{n}{conv1\PYZus{}W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv1\PYZus{}b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv1}   \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{conv2d}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{conv1\PYZus{}W}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{o}{+} \PY{n}{conv1\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{x}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Activation.}
            \PY{n}{conv1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{conv1}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolutional layer   1 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Pooling. Input = 28x28x6. Output = 14x14x6.}
            \PY{n}{conv1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{max\PYZus{}pool}\PY{p}{(}\PY{n}{conv1}\PY{p}{,} \PY{n}{ksize} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: filter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pooling layer         1 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{14}\PY{p}{,} \PY{l+m+mi}{14}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Layer 2: Convolutional. Output = 10x10x16.}
            \PY{n}{conv2\PYZus{}W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv2\PYZus{}b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv2}   \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{conv2d}\PY{p}{(}\PY{n}{conv1}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{o}{+} \PY{n}{conv2\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Activation.}
            \PY{n}{conv2} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{conv2}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolutional layer   2 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{14}\PY{p}{,} \PY{l+m+mi}{14}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Pooling. Input = 10x10x16. Output = 5x5x16.}
            \PY{n}{conv2} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{max\PYZus{}pool}\PY{p}{(}\PY{n}{conv2}\PY{p}{,} \PY{n}{ksize} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: filter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pooling layer         2 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Flatten. Input = 5x5x16. Output = 400.}
            \PY{n}{fc0}   \PY{o}{=} \PY{n}{flatten}\PY{p}{(}\PY{n}{conv2}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Layer 3: Fully Connected. Input = 400. Output = 120.}
            \PY{n}{fc1\PYZus{}W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc1\PYZus{}b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{120}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc1}   \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{fc0}\PY{p}{,} \PY{n}{fc1\PYZus{}W}\PY{p}{)} \PY{o}{+} \PY{n}{fc1\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc0}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Activation.}
            \PY{n}{fc1}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{fc1}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer 1 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Layer 4: Fully Connected. Input = 120. Output = 84.}
            \PY{n}{fc2\PYZus{}W}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{120}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc2\PYZus{}b}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{84}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc2}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{fc1}\PY{p}{,} \PY{n}{fc2\PYZus{}W}\PY{p}{)} \PY{o}{+} \PY{n}{fc2\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{120}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Activation.}
            \PY{n}{fc2}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{fc2}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer 2 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{120}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} SOLUTION: Layer 5: Fully Connected. Input = 84. Output = 43.}
            \PY{n}{fc3\PYZus{}W}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{84}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc3\PYZus{}b}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{43}\PY{p}{)}\PY{p}{)}
            \PY{n}{logits} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{fc2}\PY{p}{,} \PY{n}{fc3\PYZus{}W}\PY{p}{)} \PY{o}{+} \PY{n}{fc3\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{84}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc3\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc3\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{logits}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer 3 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{k}{return} \PY{n}{logits}\PY{p}{,} \PY{p}{(}\PY{n}{conv1\PYZus{}W}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Define your architecture here.}
        \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
        
        \PY{k}{def} \PY{n+nf}{LeNet\PYZus{}adjusted}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{,} \PY{n}{bdisplay}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} This function calculates the LeNet logits for input x}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} Inputs}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} x        : input image}
        \PY{c+c1}{\PYZsh{} bdisplay : boolean for \PYZsq{}display information\PYZsq{}}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} Outputs}
        \PY{c+c1}{\PYZsh{} ...}
        \PY{c+c1}{\PYZsh{} logits : probabilities of individual classes in input image}
            
            \PY{c+c1}{\PYZsh{} Arguments used for tf.truncated\PYZus{}normal, randomly defines variables for the weights and biases for each layer}
            \PY{n}{mu} \PY{o}{=} \PY{l+m+mi}{0}
            \PY{n}{sigma} \PY{o}{=} \PY{l+m+mf}{0.1}
            
            \PY{c+c1}{\PYZsh{} Layer 1: Convolutional. Input = 32x32x3. Output = 28x28x18.}
            \PY{n}{conv1\PYZus{}W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv1\PYZus{}b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{18}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv1}   \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{conv2d}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{conv1\PYZus{}W}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{o}{+} \PY{n}{conv1\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{x}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Activation and drop out}
            \PY{n}{conv1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{conv1}\PY{p}{)}
            \PY{n}{conv1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{conv1}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolutional layer   1 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Pooling. Input = 28x28x18. Output = 14x14x18.}
            \PY{c+c1}{\PYZsh{}conv1 = tf.nn.max\PYZus{}pool(conv1, ksize = [1, 2, 2, 1], strides = [1, 2, 2, 1], padding = \PYZsq{}VALID\PYZsq{})}
        
            \PY{c+c1}{\PYZsh{} display information}
            \PY{c+c1}{\PYZsh{}if bdisplay:}
            \PY{c+c1}{\PYZsh{}    print(\PYZsq{}Pool: filter\PYZsq{}, [1, 2, 2, 1], \PYZsq{}strides\PYZsq{}, [1, 2, 2, 1], \PYZsq{}padding\PYZsq{}, \PYZsq{}VALID\PYZsq{})}
            \PY{c+c1}{\PYZsh{}    print(\PYZsq{}Pool: inp\PYZsq{}, conv1)}
            \PY{c+c1}{\PYZsh{}    print(\PYZsq{}Pool: out\PYZsq{}, conv1)}
            
            \PY{c+c1}{\PYZsh{}print(\PYZsq{}Pooling layer         1 :\PYZsq{}, [28, 28], \PYZsq{}input dimension with depth\PYZsq{}, 18, \PYZsq{}and\PYZsq{}, [14, 14], \PYZsq{}output dimensions with depth\PYZsq{}, 18)}
            
            \PY{c+c1}{\PYZsh{} Layer 2: Convolutional. Output = 20x20x54.}
            \PY{n}{conv2\PYZus{}W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{,} \PY{l+m+mi}{54}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv2\PYZus{}b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{54}\PY{p}{)}\PY{p}{)}
            \PY{n}{conv2}   \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{conv2d}\PY{p}{(}\PY{n}{conv1}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{o}{+} \PY{n}{conv2\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{,} \PY{l+m+mi}{54}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{54}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv1}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Activation and drop out}
            \PY{n}{conv2} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{conv2}\PY{p}{)}
            \PY{n}{conv2} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{conv2}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolutional layer   2 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{28}\PY{p}{,} \PY{l+m+mi}{28}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{18}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{54}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Pooling. Input = 20x20x54. Output = 10x10x54.}
            \PY{n}{conv2} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{max\PYZus{}pool}\PY{p}{(}\PY{n}{conv2}\PY{p}{,} \PY{n}{ksize} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: filter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv2}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pooling layer         2 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{54}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{54}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Flatten. Input = 10x10x54. Output = 5400.}
            \PY{n}{fc0}   \PY{o}{=} \PY{n}{flatten}\PY{p}{(}\PY{n}{conv2}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Layer 3: Fully Connected. Input = 5400. Output = 800.}
            \PY{n}{fc1\PYZus{}W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5400}\PY{p}{,} \PY{l+m+mi}{800}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc1\PYZus{}b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{800}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc1}   \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{fc0}\PY{p}{,} \PY{n}{fc1\PYZus{}W}\PY{p}{)} \PY{o}{+} \PY{n}{fc1\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{5400}\PY{p}{,} \PY{l+m+mi}{800}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{800}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc0}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Activation and drop out}
            \PY{n}{fc1}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{fc1}\PY{p}{)}
            \PY{n}{fc1}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{fc1}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer 1 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{5400}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{800}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Layer 4: Fully Connected. Input = 800. Output = 84.}
            \PY{n}{fc2\PYZus{}W}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{800}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc2\PYZus{}b}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{84}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc2}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{fc1}\PY{p}{,} \PY{n}{fc2\PYZus{}W}\PY{p}{)} \PY{o}{+} \PY{n}{fc2\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{800}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc1}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Activation and drop out}
            \PY{n}{fc2}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{fc2}\PY{p}{)}
            \PY{n}{fc2}    \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{fc2}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer 2 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{800}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{} Layer 5: Fully Connected. Input = 84. Output = 43.}
            \PY{n}{fc3\PYZus{}W}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{84}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
            \PY{n}{fc3\PYZus{}b}  \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{43}\PY{p}{)}\PY{p}{)}
            \PY{n}{logits} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{fc2}\PY{p}{,} \PY{n}{fc3\PYZus{}W}\PY{p}{)} \PY{o}{+} \PY{n}{fc3\PYZus{}b}
            
            \PY{c+c1}{\PYZsh{} display information}
            \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{84}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc2}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc3\PYZus{}W}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc3\PYZus{}b}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{logits}\PY{p}{)}
            
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer 3 :}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{43}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{k}{return} \PY{n}{logits}\PY{p}{,} \PY{p}{(}\PY{n}{conv1\PYZus{}W}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}37}]:} \PY{c+c1}{\PYZsh{} this cell is not used}
         
         \PY{k}{def} \PY{n+nf}{determine\PYZus{}outputs}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{filter\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function calculates the output dimensions of a convolutional operation}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} input\PYZus{}dims  : dimensions of input (height, width)}
         \PY{c+c1}{\PYZsh{} filter\PYZus{}size : size of filter [height, width]}
         \PY{c+c1}{\PYZsh{} strides     : value of strides [height\PYZus{}step, width\PYZus{}step]}
         \PY{c+c1}{\PYZsh{} padding     : type of padding operation \PYZob{}\PYZsq{}VALID\PYZsq{}, \PYZsq{}SAME\PYZsq{}\PYZcb{}}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} output\PYZus{}dims : dimensions of output (height, width)}
             
             \PY{c+c1}{\PYZsh{} initialize output}
             \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{k+kc}{None}
             
             \PY{c+c1}{\PYZsh{} valid padding}
             \PY{k}{if} \PY{n}{padding} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                 \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PYZbs{}
                                         \PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
                 
             \PY{c+c1}{\PYZsh{} same padding}
             \PY{k}{elif} \PY{n}{padding} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SAME}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                 \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PYZbs{}
                                         \PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} unknown padding}
             \PY{k}{else}\PY{p}{:}
                 \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{k+kc}{None}
             
             \PY{k}{return} \PY{n}{output\PYZus{}dims}
             
         \PY{k}{def} \PY{n+nf}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{output\PYZus{}depth}\PY{p}{,} \PY{n}{filter\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{bdisplay} \PY{o}{=} \PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function calculates a convolutional layer}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} inp          : input feature map}
         \PY{c+c1}{\PYZsh{} input\PYZus{}dims   : height and width dimensions of input (height, width)}
         \PY{c+c1}{\PYZsh{} input\PYZus{}depth  : feature dimensions of input}
         \PY{c+c1}{\PYZsh{} output\PYZus{}depth : feature dimensions of output}
         \PY{c+c1}{\PYZsh{} filter\PYZus{}size  : size of filter [height, width]}
         \PY{c+c1}{\PYZsh{} strides      : value of strides [height\PYZus{}step, width\PYZus{}step]}
         \PY{c+c1}{\PYZsh{} padding      : type of padding operation \PYZob{}\PYZsq{}VALID\PYZsq{}, \PYZsq{}SAME\PYZsq{}\PYZcb{}}
         \PY{c+c1}{\PYZsh{} mean         : mean of random initialization}
         \PY{c+c1}{\PYZsh{} stddev       : standard deviation of random initialization}
         \PY{c+c1}{\PYZsh{} bdisplay     : boolean for \PYZsq{}display information\PYZsq{}}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} out         : output feature map}
         \PY{c+c1}{\PYZsh{} output\PYZus{}dims : height and width dimensions of output (height, width)}
             
             \PY{c+c1}{\PYZsh{} calculate linear operators}
             \PY{n}{W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{output\PYZus{}depth}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mean}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{stddev}\PY{p}{)}\PY{p}{)}
             \PY{n}{b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{output\PYZus{}depth}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} execute convolution}
             \PY{n}{out} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{conv2d}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{W}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{n}{padding}\PY{p}{)} \PY{o}{+} \PY{n}{b}
             
             \PY{c+c1}{\PYZsh{} display information}
             \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{output\PYZus{}depth}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{output\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mean}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{stddev}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inp}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{W}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{b}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{out}\PY{p}{)}
             
             \PY{k}{return} \PY{n}{out}\PY{p}{,} \PY{n}{determine\PYZus{}outputs}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{,} \PY{n}{strides}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
         
         \PY{k}{def} \PY{n+nf}{maxpool}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{k\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{bdisplay} \PY{o}{=} \PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function calculates a max pooling layer}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} inp        : input feature map}
         \PY{c+c1}{\PYZsh{} input\PYZus{}dims : height and width dimensions of input (height, width)}
         \PY{c+c1}{\PYZsh{} k\PYZus{}size     : size of filter [height, width]}
         \PY{c+c1}{\PYZsh{} strides    : value of strides [height\PYZus{}step, width\PYZus{}step]}
         \PY{c+c1}{\PYZsh{} padding    : type of padding operation \PYZob{}\PYZsq{}VALID\PYZsq{}, \PYZsq{}SAME\PYZsq{}\PYZcb{}}
         \PY{c+c1}{\PYZsh{} bdisplay   : boolean for \PYZsq{}display information\PYZsq{}}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} out         : output feature map}
         \PY{c+c1}{\PYZsh{} output\PYZus{}dims : height and width dimensions of output (height, width)}
             
             \PY{c+c1}{\PYZsh{} execute pooling}
             \PY{n}{out} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{max\PYZus{}pool}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display information}
             \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: filter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inp}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{out}\PY{p}{)}
             
             \PY{k}{return} \PY{n}{out}\PY{p}{,} \PY{n}{determine\PYZus{}outputs}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{,} \PY{n}{strides}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
         
         \PY{k}{def} \PY{n+nf}{LeNet\PYZus{}adjusted\PYZus{}method}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{,} \PY{n}{image\PYZus{}shape}\PY{p}{,} \PY{n}{n\PYZus{}classes}\PY{p}{,} \PY{n}{bdisplay}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function calculates the LeNet\PYZhy{}type logits for input x}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} x            : input image}
         \PY{c+c1}{\PYZsh{} tf\PYZus{}keep\PYZus{}prob : tensorflow parameter for dropout}
         \PY{c+c1}{\PYZsh{} image\PYZus{}shape  : height and width dimensions of input image (height, width)}
         \PY{c+c1}{\PYZsh{} n\PYZus{}classes    : number of output classes}
         \PY{c+c1}{\PYZsh{} bdisplay     : boolean for \PYZsq{}display information\PYZsq{}}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} logits : probabilities of individual classes in input image}
             
             \PY{c+c1}{\PYZsh{} define constants}
             \PY{n}{mu} \PY{o}{=} \PY{l+m+mi}{0} \PY{c+c1}{\PYZsh{} mean used to initialize weights with random values}
             \PY{n}{sigma} \PY{o}{=} \PY{l+m+mf}{0.1} \PY{c+c1}{\PYZsh{} standard deviation used to initialize weights with random values}
             \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}} \PY{c+c1}{\PYZsh{} use valid padding everywhere}
             
             \PY{c+c1}{\PYZsh{} define layer dimensions}
             \PY{c+c1}{\PYZsh{}conv\PYZus{}depths = np.array([12, 24, 32], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}filter\PYZus{}sizes = np.array([5, 5, 5], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}conv\PYZus{}strides = np.array([1, 1, 1], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}pool\PYZus{}sizes = np.array([2, 2, 2], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}pool\PYZus{}strides = np.array([2, 2, 2], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}fc\PYZus{}depths = np.array([800, 200, n\PYZus{}classes], dtype = np.int32)}
             \PY{n}{conv\PYZus{}depths} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{filter\PYZus{}sizes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{conv\PYZus{}strides} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{pool\PYZus{}sizes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{pool\PYZus{}strides} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{fc\PYZus{}depths} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{120}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{n}{n\PYZus{}classes}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize convolution layer results}
             \PY{n}{convs} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{conv\PYZus{}dims} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} execute all convolution layers}
             \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{conv\PYZus{}depth} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{conv\PYZus{}depths}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for first layer}
                 \PY{k}{if} \PY{p}{(}\PY{n}{idx} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{x}
                     \PY{n}{input\PYZus{}shape} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{image\PYZus{}shape}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
                     \PY{n}{input\PYZus{}dims} \PY{o}{=} \PY{n}{input\PYZus{}shape}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{n}{input\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}           
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for every other layer}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{convs}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{input\PYZus{}dims} \PY{o}{=} \PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{n}{conv\PYZus{}depths}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} execute convolutional layer}
                 \PY{n}{conv}\PY{p}{,} \PY{n}{conv\PYZus{}dim} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{,} \PY{n}{filter\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{n}{filter\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{filter\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{n}{conv\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{conv\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{n}{padding}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{,} \PY{n}{bdisplay} \PY{o}{=} \PY{n}{bdisplay}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute activation and drop out}
                 \PY{n}{conv} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{conv}\PY{p}{)}
                 \PY{n}{conv} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{conv}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
             
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolutional layer  }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}dim}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute pooling}
                 \PY{k}{if} \PY{p}{(}\PY{n}{pool\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{pool}\PY{p}{,} \PY{n}{pool\PYZus{}dim} \PY{o}{=} \PY{n}{maxpool}\PY{p}{(}\PY{n}{conv}\PY{p}{,} \PY{n}{conv\PYZus{}dim}\PY{p}{,} \PY{n}{k\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{n}{pool\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{pool\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{n}{pool\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{pool\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{n}{padding}\PY{p}{,} \PY{n}{bdisplay} \PY{o}{=} \PY{n}{bdisplay}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pooling layer        }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}dim}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{pool\PYZus{}dim}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{)}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{pool}\PY{p}{,} \PY{n}{pool\PYZus{}dim} \PY{o}{=} \PY{n}{conv}\PY{p}{,} \PY{n}{conv\PYZus{}dim}
                 
                 \PY{c+c1}{\PYZsh{} save results}
                 \PY{n}{convs}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pool}\PY{p}{)}
                 \PY{n}{conv\PYZus{}dims}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pool\PYZus{}dim}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize fully connected layer results}
             \PY{n}{fcs} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{fc\PYZus{}dims} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} execute all fully connected layers}
             \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{fc\PYZus{}depth} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{fc\PYZus{}depths}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for first layer}
                 \PY{k}{if} \PY{p}{(}\PY{n}{idx} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{flatten}\PY{p}{(}\PY{n}{convs}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{p}{(}\PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{*} \PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{*} \PY{n}{conv\PYZus{}depths}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for every other layer}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{fcs}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{n}{fc\PYZus{}dims}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} calculate linear operators}
                 \PY{n}{W} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}
                 \PY{n}{b} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute fully connected layer}
                 \PY{n}{fc} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{W}\PY{p}{)} \PY{o}{+} \PY{n}{b}
                 
                 \PY{c+c1}{\PYZsh{} display information}
                 \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inp}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{W}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{b}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute activation and drop out}
                 \PY{n}{fc} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
                 \PY{n}{fc} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{fc}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
                 
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} save results}
                 \PY{n}{fcs}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
                 \PY{n}{fc\PYZus{}dims}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} retrieve result}
             \PY{n}{logits} \PY{o}{=} \PY{n}{fcs}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
             
             \PY{k}{return} \PY{n}{logits}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{c+c1}{\PYZsh{} this cell is not used}
         
         \PY{k}{def} \PY{n+nf}{determine\PYZus{}outputs}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{filter\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function calculates the output dimensions of a convolutional operation}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} input\PYZus{}dims  : dimensions of input (height, width)}
         \PY{c+c1}{\PYZsh{} filter\PYZus{}size : size of filter [height, width]}
         \PY{c+c1}{\PYZsh{} strides     : value of strides [height\PYZus{}step, width\PYZus{}step]}
         \PY{c+c1}{\PYZsh{} padding     : type of padding operation \PYZob{}\PYZsq{}VALID\PYZsq{}, \PYZsq{}SAME\PYZsq{}\PYZcb{}}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} output\PYZus{}dims : dimensions of output (height, width)}
             
             \PY{c+c1}{\PYZsh{} initialize output}
             \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{k+kc}{None}
             
             \PY{c+c1}{\PYZsh{} valid padding}
             \PY{k}{if} \PY{n}{padding} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                 \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PYZbs{}
                                         \PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
                 
             \PY{c+c1}{\PYZsh{} same padding}
             \PY{k}{elif} \PY{n}{padding} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SAME}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                 \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PYZbs{}
                                         \PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} unknown padding}
             \PY{k}{else}\PY{p}{:}
                 \PY{n}{output\PYZus{}dims} \PY{o}{=} \PY{k+kc}{None}
             
             \PY{k}{return} \PY{n}{output\PYZus{}dims}
             
         \PY{k}{def} \PY{n+nf}{LeNet\PYZus{}adjusted\PYZus{}inlinemethod}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{,} \PY{n}{image\PYZus{}shape}\PY{p}{,} \PY{n}{n\PYZus{}classes}\PY{p}{,} \PY{n}{bdisplay}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function calculates the LeNet\PYZhy{}type logits for input x}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} x            : input image}
         \PY{c+c1}{\PYZsh{} tf\PYZus{}keep\PYZus{}prob : tensorflow parameter for dropout}
         \PY{c+c1}{\PYZsh{} image\PYZus{}shape  : height and width dimensions of input image (height, width)}
         \PY{c+c1}{\PYZsh{} n\PYZus{}classes    : number of output classes}
         \PY{c+c1}{\PYZsh{} bdisplay     : boolean for \PYZsq{}display information\PYZsq{}}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} logits : probabilities of individual classes in input image}
             
             \PY{c+c1}{\PYZsh{} define constants}
             \PY{n}{mu} \PY{o}{=} \PY{l+m+mi}{0} \PY{c+c1}{\PYZsh{} mean used to initialize weights with random values}
             \PY{n}{sigma} \PY{o}{=} \PY{l+m+mf}{0.1} \PY{c+c1}{\PYZsh{} standard deviation used to initialize weights with random values}
             \PY{n}{padding} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VALID}\PY{l+s+s1}{\PYZsq{}} \PY{c+c1}{\PYZsh{} use valid padding everywhere}
             
             \PY{c+c1}{\PYZsh{} define layer dimensions}
             \PY{c+c1}{\PYZsh{}conv\PYZus{}depths = np.array([12, 24, 32], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}filter\PYZus{}sizes = np.array([5, 5, 5], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}conv\PYZus{}strides = np.array([1, 1, 1], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}pool\PYZus{}sizes = np.array([2, 2, 2], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}pool\PYZus{}strides = np.array([2, 2, 2], dtype = np.int32)}
             \PY{c+c1}{\PYZsh{}fc\PYZus{}depths = np.array([800, 200, n\PYZus{}classes], dtype = np.int32)}
             \PY{n}{conv\PYZus{}depths} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{filter\PYZus{}sizes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{conv\PYZus{}strides} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{pool\PYZus{}sizes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{pool\PYZus{}strides} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             \PY{n}{fc\PYZus{}depths} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{120}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{,} \PY{n}{n\PYZus{}classes}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize convolution layer variables and results}
             \PY{n}{W\PYZus{}conv} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{b\PYZus{}conv} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{convs} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{conv\PYZus{}dims} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} execute all convolution layers}
             \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{conv\PYZus{}depth} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{conv\PYZus{}depths}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for first layer}
                 \PY{k}{if} \PY{p}{(}\PY{n}{idx} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{x}
                     \PY{n}{input\PYZus{}shape} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{image\PYZus{}shape}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
                     \PY{n}{input\PYZus{}dims} \PY{o}{=} \PY{n}{input\PYZus{}shape}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{n}{input\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}           
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for every other layer}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{convs}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{input\PYZus{}dims} \PY{o}{=} \PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{n}{conv\PYZus{}depths}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} calculate layer parameters}
                 \PY{n}{filter\PYZus{}size} \PY{o}{=} \PY{p}{(}\PY{n}{filter\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{filter\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{)}
                 \PY{n}{conv\PYZus{}strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{conv\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{conv\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
                 \PY{n}{k\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{pool\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{pool\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
                 \PY{n}{pool\PYZus{}strides} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{pool\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{pool\PYZus{}strides}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} calculate linear operators}
                 \PY{n}{W\PYZus{}conv}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{n}{filter\PYZus{}size}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 \PY{n}{b\PYZus{}conv}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{conv\PYZus{}depth}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute convolution}
                 \PY{n}{convs}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{conv2d}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{W\PYZus{}conv}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{strides} \PY{o}{=} \PY{n}{conv\PYZus{}strides}\PY{p}{,} \PY{n}{padding} \PY{o}{=} \PY{n}{padding}\PY{p}{)} \PY{o}{+} \PY{n}{b\PYZus{}conv}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 \PY{n}{conv\PYZus{}dim} \PY{o}{=} \PY{p}{(}\PY{n}{determine\PYZus{}outputs}\PY{p}{(}\PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,} \PY{n}{conv\PYZus{}strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,} \PY{n}{padding}\PY{p}{)}\PY{p}{)}
                 \PY{n}{conv\PYZus{}dims}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{conv\PYZus{}dim}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} display information}
                 \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}strides}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inp}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{W\PYZus{}conv}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{b\PYZus{}conv}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Conv: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute activation and drop out}
                 \PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 \PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
             
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Convolutional layer  }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}dims}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}dim}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute pooling if necessary}
                 \PY{k}{if} \PY{p}{(}\PY{n}{pool\PYZus{}sizes}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} execute pooling}
                     \PY{n}{pool\PYZus{}inp} \PY{o}{=} \PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}
                     \PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{max\PYZus{}pool}\PY{p}{(}\PY{n}{pool\PYZus{}inp}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{,} \PY{n}{pool\PYZus{}strides}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
                     \PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{=} \PY{n}{determine\PYZus{}outputs}\PY{p}{(}\PY{n}{conv\PYZus{}dim}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,} \PY{n}{pool\PYZus{}strides}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
                     
                     \PY{c+c1}{\PYZsh{} display information}
                     \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: filter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{strides}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{pool\PYZus{}strides}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{padding}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{padding}\PY{p}{)}
                         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{pool\PYZus{}inp}\PY{p}{)}
                         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pool: out}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{convs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                     
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pooling layer        }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}dim}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimension with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions with depth}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{conv\PYZus{}depth}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize fully connected layer variables and results}
             \PY{n}{W\PYZus{}fc} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{b\PYZus{}fc} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{fcs} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{fc\PYZus{}dims} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} execute all fully connected layers}
             \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{fc\PYZus{}depth} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{fc\PYZus{}depths}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for first layer}
                 \PY{k}{if} \PY{p}{(}\PY{n}{idx} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{flatten}\PY{p}{(}\PY{n}{convs}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{p}{(}\PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{*} \PY{n}{conv\PYZus{}dims}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{*} \PY{n}{conv\PYZus{}depths}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} define input feature map and dimensions for every other layer}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{inp} \PY{o}{=} \PY{n}{fcs}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{input\PYZus{}depth} \PY{o}{=} \PY{n}{fc\PYZus{}dims}\PY{p}{[}\PY{n}{idx} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} calculate linear operators}
                 \PY{n}{W\PYZus{}fc}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{truncated\PYZus{}normal}\PY{p}{(}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{mean} \PY{o}{=} \PY{n}{mu}\PY{p}{,} \PY{n}{stddev} \PY{o}{=} \PY{n}{sigma}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 \PY{n}{b\PYZus{}fc}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{Variable}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute fully connected layer}
                 \PY{n}{fcs}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{matmul}\PY{p}{(}\PY{n}{inp}\PY{p}{,} \PY{n}{W\PYZus{}fc}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{n}{b\PYZus{}fc}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 \PY{n}{fc\PYZus{}dims}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} display information}
                 \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{zeros}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stddev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: inp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inp}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{W\PYZus{}fc}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{b\PYZus{}fc}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Full: fc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fcs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} execute activation and drop out}
                 \PY{n}{fcs}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{relu}\PY{p}{(}\PY{n}{fcs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 \PY{n}{fcs}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{dropout}\PY{p}{(}\PY{n}{fcs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{)}
                 
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fully connected layer}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{input\PYZus{}depth}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{input dimensions and}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fc\PYZus{}depths}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{output dimensions}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 
             \PY{c+c1}{\PYZsh{} retrieve result}
             \PY{n}{logits} \PY{o}{=} \PY{n}{fcs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}
             
             \PY{k}{return} \PY{n}{logits}
\end{Verbatim}


    \subsubsection{Train, Validate and Test the
Model}\label{train-validate-and-test-the-model}

    A validation set can be used to assess how well the model is performing.
A low accuracy on the training and validation sets imply underfitting. A
high accuracy on the training set but low accuracy on the validation set
implies overfitting.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}40}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Train your model here.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Calculate and report the accuracy on the training and validation set.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Once a final model architecture is selected, }
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} the accuracy on the test set should be calculated and reported as well.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
         
         \PY{c+c1}{\PYZsh{} Use DROPOUT etc. to not overfit !!!}
         
         \PY{c+c1}{\PYZsh{} define constants}
         \PY{n}{bdisplay} \PY{o}{=} \PY{k+kc}{False}
         \PY{n}{epochs} \PY{o}{=} \PY{l+m+mi}{40}
         \PY{n}{batch\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{128}
         \PY{n}{rate} \PY{o}{=} \PY{l+m+mf}{0.0005}
         \PY{n}{keep\PYZus{}prob} \PY{o}{=} \PY{l+m+mf}{0.5}
         \PY{n}{beta} \PY{o}{=} \PY{l+m+mf}{0.1}
         
         \PY{c+c1}{\PYZsh{} define tensorflow parameters}
         \PY{n}{x} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{placeholder}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{float32}\PY{p}{,} \PY{p}{(}\PY{k+kc}{None}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{y} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{placeholder}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{int32}\PY{p}{,} \PY{p}{(}\PY{k+kc}{None}\PY{p}{)}\PY{p}{,} \PY{n}{name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{tf\PYZus{}keep\PYZus{}prob} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{placeholder}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{float32}\PY{p}{,} \PY{p}{(}\PY{k+kc}{None}\PY{p}{)}\PY{p}{,} \PY{n}{name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tf\PYZus{}keep\PYZus{}prob}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}41}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} define pipelines}
         
         \PY{c+c1}{\PYZsh{} forward propagation}
         \PY{n}{one\PYZus{}hot\PYZus{}y} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{one\PYZus{}hot}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{n\PYZus{}classes}\PY{p}{)}
         \PY{n}{logits\PYZus{}orig}\PY{p}{,} \PY{n}{conv\PYZus{}Ws} \PY{o}{=} \PY{n}{LeNet}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{bdisplay}\PY{p}{)}
         \PY{n}{logits\PYZus{}adjusted}\PY{p}{,} \PY{n}{conv\PYZus{}Ws} \PY{o}{=} \PY{n}{LeNet\PYZus{}adjusted}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{,} \PY{n}{bdisplay}\PY{p}{)}
         \PY{n}{logits} \PY{o}{=} \PY{n}{logits\PYZus{}adjusted}
         
         \PY{c+c1}{\PYZsh{} training (backpropagation)}
         \PY{n}{cross\PYZus{}entropy} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{softmax\PYZus{}cross\PYZus{}entropy\PYZus{}with\PYZus{}logits}\PY{p}{(}\PY{n}{labels} \PY{o}{=} \PY{n}{one\PYZus{}hot\PYZus{}y}\PY{p}{,} \PY{n}{logits} \PY{o}{=} \PY{n}{logits}\PY{p}{)}
         \PY{n}{regularizer1} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{l2\PYZus{}loss}\PY{p}{(}\PY{n}{conv\PYZus{}Ws}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
         \PY{n}{regularizer2} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{l2\PYZus{}loss}\PY{p}{(}\PY{n}{conv\PYZus{}Ws}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
         \PY{n}{loss\PYZus{}operation} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{reduce\PYZus{}mean}\PY{p}{(}\PY{n}{cross\PYZus{}entropy} \PY{o}{+} \PY{p}{(}\PY{n}{beta} \PY{o}{*} \PY{p}{(}\PY{n}{regularizer1} \PY{o}{+} \PY{n}{regularizer2}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n}{loss\PYZus{}operation} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{reduce\PYZus{}mean}\PY{p}{(}\PY{n}{cross\PYZus{}entropy}\PY{p}{)}
         \PY{n}{optimizer} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{AdamOptimizer}\PY{p}{(}\PY{n}{learning\PYZus{}rate} \PY{o}{=} \PY{n}{rate}\PY{p}{)}
         \PY{n}{training\PYZus{}operation} \PY{o}{=} \PY{n}{optimizer}\PY{o}{.}\PY{n}{minimize}\PY{p}{(}\PY{n}{loss\PYZus{}operation}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} evaluation}
         \PY{n}{correct\PYZus{}prediction} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{equal}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{logits}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{one\PYZus{}hot\PYZus{}y}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{accuracy\PYZus{}operation} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{reduce\PYZus{}mean}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{cast}\PY{p}{(}\PY{n}{correct\PYZus{}prediction}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{float32}\PY{p}{)}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} initialize saver object}
         \PY{n}{saver} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{Saver}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Convolutional layer   1 : [32, 32] input dimension with depth 3 and [28, 28] output dimensions with depth 6
Pooling layer         1 : [28, 28] input dimension with depth 6 and [14, 14] output dimensions with depth 6
Convolutional layer   2 : [14, 14] input dimension with depth 6 and [10, 10] output dimensions with depth 16
Pooling layer         2 : [10, 10] input dimension with depth 16 and [5, 5] output dimensions with depth 16
Fully connected layer 1 : 400 input dimensions and 120 output dimensions
Fully connected layer 2 : 120 input dimensions and 84 output dimensions
Fully connected layer 3 : 84 input dimensions and 43 output dimensions
Convolutional layer   1 : [32, 32] input dimension with depth 3 and [28, 28] output dimensions with depth 18
Convolutional layer   2 : [28, 28] input dimension with depth 18 and [20, 20] output dimensions with depth 54
Pooling layer         2 : [20, 20] input dimension with depth 54 and [10, 10] output dimensions with depth 54
Fully connected layer 1 : 5400 input dimensions and 800 output dimensions
Fully connected layer 2 : 800 input dimensions and 84 output dimensions
Fully connected layer 3 : 84 input dimensions and 43 output dimensions

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{k}{def} \PY{n+nf}{evaluate}\PY{p}{(}\PY{n}{session}\PY{p}{,} \PY{n}{X\PYZus{}data}\PY{p}{,} \PY{n}{y\PYZus{}data}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function plots a set of traffic sign images}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} session    : tensorflow session}
         \PY{c+c1}{\PYZsh{} X\PYZus{}data     : feature list}
         \PY{c+c1}{\PYZsh{} y\PYZus{}data     : label list}
         \PY{c+c1}{\PYZsh{} batch\PYZus{}size : batch size}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} relative\PYZus{}accuracy : relative accuracy}
             
             \PY{c+c1}{\PYZsh{} create session object}
             \PY{n}{session} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{get\PYZus{}default\PYZus{}session}\PY{p}{(}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize output}
             \PY{n}{total\PYZus{}accuracy} \PY{o}{=} \PY{l+m+mi}{0}
             
             \PY{c+c1}{\PYZsh{} initial calculations}
             \PY{n}{num\PYZus{}examples} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}data}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} for all batches do}
             \PY{k}{for} \PY{n}{offset} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{num\PYZus{}examples}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} define current batch }
                 \PY{n}{batch\PYZus{}x}\PY{p}{,} \PY{n}{batch\PYZus{}y} \PY{o}{=} \PY{n}{X\PYZus{}data}\PY{p}{[}\PY{n}{offset}\PY{p}{:}\PY{p}{(}\PY{n}{offset} \PY{o}{+} \PY{n}{batch\PYZus{}size}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{y\PYZus{}data}\PY{p}{[}\PY{n}{offset}\PY{p}{:}\PY{p}{(}\PY{n}{offset} \PY{o}{+} \PY{n}{batch\PYZus{}size}\PY{p}{)}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} calculate accuracy}
                 \PY{n}{accuracy} \PY{o}{=} \PY{n}{session}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{accuracy\PYZus{}operation}\PY{p}{,} \PY{n}{feed\PYZus{}dict}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{x}\PY{p}{:} \PY{n}{batch\PYZus{}x}\PY{p}{,} \PY{n}{y}\PY{p}{:} \PY{n}{batch\PYZus{}y}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{:} \PY{n}{keep\PYZus{}prob}\PY{p}{\PYZcb{}}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} increment total accuracy}
                 \PY{n}{total\PYZus{}accuracy} \PY{o}{+}\PY{o}{=} \PY{p}{(}\PY{n}{accuracy} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{batch\PYZus{}x}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} calculate output}
             \PY{n}{relative\PYZus{}accuracy} \PY{o}{=} \PY{n}{total\PYZus{}accuracy} \PY{o}{/} \PY{n}{num\PYZus{}examples}
             
             \PY{k}{return} \PY{n}{relative\PYZus{}accuracy}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{k}{with} \PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{sess}\PY{p}{:}
             \PY{n}{sess}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{tf}\PY{o}{.}\PY{n}{global\PYZus{}variables\PYZus{}initializer}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display message}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Training...}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} iterate over all epochs}
             \PY{k}{for} \PY{n}{idx} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{epochs}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} shuffle training data in each epoch}
                 \PY{n}{X\PYZus{}train\PYZus{}norm}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}conv} \PY{o}{=} \PY{n}{shuffle}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}norm}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}conv}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} iterate over all batches}
                 \PY{k}{for} \PY{n}{offset} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{n\PYZus{}train}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{p}{)}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} get current batch training set}
                     \PY{n}{end} \PY{o}{=} \PY{n}{offset} \PY{o}{+} \PY{n}{batch\PYZus{}size}
                     \PY{n}{batch\PYZus{}x}\PY{p}{,} \PY{n}{batch\PYZus{}y} \PY{o}{=} \PY{n}{X\PYZus{}train\PYZus{}norm}\PY{p}{[}\PY{n}{offset}\PY{p}{:}\PY{n}{end}\PY{p}{]}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}conv}\PY{p}{[}\PY{n}{offset}\PY{p}{:}\PY{n}{end}\PY{p}{]}
                     
                     \PY{c+c1}{\PYZsh{} execute training operation}
                     \PY{n}{sess}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{training\PYZus{}operation}\PY{p}{,} \PY{n}{feed\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{x}\PY{p}{:} \PY{n}{batch\PYZus{}x}\PY{p}{,} \PY{n}{y}\PY{p}{:} \PY{n}{batch\PYZus{}y}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{:} \PY{n}{keep\PYZus{}prob}\PY{p}{\PYZcb{}}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} validate accuracy current of epoch}
                 \PY{n}{validation\PYZus{}accuracy} \PY{o}{=} \PY{n}{evaluate}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{X\PYZus{}valid\PYZus{}norm}\PY{p}{,} \PY{n}{y\PYZus{}valid\PYZus{}conv}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} display validation accuracy of current epoch}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{EPOCH }\PY{l+s+si}{\PYZob{}:4d\PYZcb{}}\PY{l+s+s2}{:}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Validation Accuracy = }\PY{l+s+si}{\PYZob{}:.3f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{validation\PYZus{}accuracy}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} save training result}
             \PY{n}{saver}\PY{o}{.}\PY{n}{save}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/temp\PYZus{}data/tsclass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display message}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model saved}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Training{\ldots}
EPOCH    1: Validation Accuracy = 0.057
EPOCH    2: Validation Accuracy = 0.073
EPOCH    3: Validation Accuracy = 0.150
EPOCH    4: Validation Accuracy = 0.254
EPOCH    5: Validation Accuracy = 0.399
EPOCH    6: Validation Accuracy = 0.495
EPOCH    7: Validation Accuracy = 0.582
EPOCH    8: Validation Accuracy = 0.667
EPOCH    9: Validation Accuracy = 0.733
EPOCH   10: Validation Accuracy = 0.778
EPOCH   11: Validation Accuracy = 0.791
EPOCH   12: Validation Accuracy = 0.810
EPOCH   13: Validation Accuracy = 0.844
EPOCH   14: Validation Accuracy = 0.860
EPOCH   15: Validation Accuracy = 0.871
EPOCH   16: Validation Accuracy = 0.874
EPOCH   17: Validation Accuracy = 0.886
EPOCH   18: Validation Accuracy = 0.887
EPOCH   19: Validation Accuracy = 0.894
EPOCH   20: Validation Accuracy = 0.892
EPOCH   21: Validation Accuracy = 0.898
EPOCH   22: Validation Accuracy = 0.903
EPOCH   23: Validation Accuracy = 0.908
EPOCH   24: Validation Accuracy = 0.908
EPOCH   25: Validation Accuracy = 0.910
EPOCH   26: Validation Accuracy = 0.916
EPOCH   27: Validation Accuracy = 0.909
EPOCH   28: Validation Accuracy = 0.918
EPOCH   29: Validation Accuracy = 0.916
EPOCH   30: Validation Accuracy = 0.920
EPOCH   31: Validation Accuracy = 0.922
EPOCH   32: Validation Accuracy = 0.923
EPOCH   33: Validation Accuracy = 0.930
EPOCH   34: Validation Accuracy = 0.927
EPOCH   35: Validation Accuracy = 0.925
EPOCH   36: Validation Accuracy = 0.928
EPOCH   37: Validation Accuracy = 0.929
EPOCH   38: Validation Accuracy = 0.924
EPOCH   39: Validation Accuracy = 0.929
EPOCH   40: Validation Accuracy = 0.932
Model saved

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{k}{with} \PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{sess}\PY{p}{:}
             \PY{n}{saver}\PY{o}{.}\PY{n}{restore}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{latest\PYZus{}checkpoint}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/temp\PYZus{}data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{test\PYZus{}accuracy} \PY{o}{=} \PY{n}{evaluate}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{X\PYZus{}test\PYZus{}norm}\PY{p}{,} \PY{n}{y\PYZus{}test\PYZus{}conv}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Test Accuracy = }\PY{l+s+si}{\PYZob{}:.3f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{test\PYZus{}accuracy}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass
Test Accuracy = 0.930

    \end{Verbatim}

    \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Step 3: Test a Model on New
Images}\label{step-3-test-a-model-on-new-images}

To give yourself more insight into how your model is working, download
at least five pictures of German traffic signs from the web and use your
model to predict the traffic sign type.

You may find \texttt{signnames.csv} useful as it contains mappings from
the class id (integer) to the actual sign name.

    \subsubsection{Load and Output the
Images}\label{load-and-output-the-images}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Load the images and plot them here.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
         
         \PY{c+c1}{\PYZsh{} define constants}
         \PY{n}{subfolder} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{own}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{imagemask} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{*.jpg}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{ownlabelnums} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{38}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{14}\PY{p}{]}
         \PY{n}{unknownlabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Untrained traffic sign}\PY{l+s+s1}{\PYZsq{}}
         
         \PY{k}{def} \PY{n+nf}{load\PYZus{}images}\PY{p}{(}\PY{n}{subfolder}\PY{p}{,} \PY{n}{imagemask}\PY{p}{,} \PY{n}{checklabelnums}\PY{p}{,} \PY{n}{labeldict}\PY{p}{,} \PY{n}{unknownlabel}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function loads images to be checked}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} subfolder      : subfolder with images to be checked}
         \PY{c+c1}{\PYZsh{} imagemask      : file name mask for images to be checked}
         \PY{c+c1}{\PYZsh{} checklabelnums : dictionary of image labels}
         \PY{c+c1}{\PYZsh{} labeldict      : dictionary of image labels}
         \PY{c+c1}{\PYZsh{} unknownlabel   : label to be used for unknown labels (label number \PYZlt{}= 0)}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} checkimages : array of images to be checked}
         \PY{c+c1}{\PYZsh{} checklabels : labels of images to be checked}
             
             \PY{c+c1}{\PYZsh{} get path to images}
             \PY{n}{fileimages} \PY{o}{=} \PY{n}{glob}\PY{o}{.}\PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{subfolder}\PY{p}{,} \PY{n}{imagemask}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize variables}
             \PY{n}{checkimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{checklabels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 
             \PY{c+c1}{\PYZsh{} loop through check images}
             \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{fileimage} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{fileimages}\PY{p}{)}\PY{p}{:}
                     
                 \PY{c+c1}{\PYZsh{} read check image}
                 \PY{n}{checkimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{mpimg}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{fileimage}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} get image label}
                 \PY{k}{if} \PY{p}{(}\PY{n}{checklabelnums}\PY{p}{[}\PY{n}{idx}\PY{p}{]} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                     \PY{n}{currentlabel} \PY{o}{=} \PY{n}{labeldict}\PY{p}{[}\PY{n}{checklabelnums}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{]}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{currentlabel} \PY{o}{=} \PY{n}{unknownlabel}
                 \PY{n}{checklabels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{currentlabel}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} plot check images with correct labels}
             \PY{n}{checkimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{checkimages}\PY{p}{)}
             \PY{n}{checklabels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{checklabels}\PY{p}{)}
             \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{checkimages}\PY{p}{,} \PY{n}{checklabels}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{checkimages}\PY{p}{)}\PY{p}{)}
             
             \PY{k}{return} \PY{n}{checkimages}\PY{p}{,} \PY{n}{checklabels}
         
         \PY{n}{ownimages}\PY{p}{,} \PY{n}{ownlabels} \PY{o}{=} \PY{n}{load\PYZus{}images}\PY{p}{(}\PY{n}{subfolder}\PY{p}{,} \PY{n}{imagemask}\PY{p}{,} \PY{n}{ownlabelnums}\PY{p}{,} \PY{n}{labeldict}\PY{p}{,} \PY{n}{unknownlabel}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_30_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{Predict the Sign Type for Each
Image}\label{predict-the-sign-type-for-each-image}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Run the predictions here and use the model to output the prediction for each image.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Make sure to pre\PYZhy{}process the images with the same pre\PYZhy{}processing pipeline used earlier.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
         
         \PY{k}{def} \PY{n+nf}{predict\PYZus{}image\PYZus{}labels}\PY{p}{(}\PY{n}{checkimages}\PY{p}{,} \PY{n}{labeldict}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function predicts labels for images}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} checkimages : images for which labels should be predicted}
         \PY{c+c1}{\PYZsh{} labeldict   : dictionary of image labels}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} checklabelnums\PYZus{}pred : array of predicted label numbers}
         \PY{c+c1}{\PYZsh{} checklabels\PYZus{}pred    : predicted labels}
         \PY{c+c1}{\PYZsh{} checkimages\PYZus{}norm    : normized images}
             
             \PY{c+c1}{\PYZsh{} define constants}
             \PY{n}{session\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/temp\PYZus{}data}\PY{l+s+s1}{\PYZsq{}}
             
             \PY{c+c1}{\PYZsh{} normalize input data}
             \PY{n}{checkimages\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{checkimages} \PY{o}{/} \PY{l+m+mf}{127.5}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} restore trained network}
             \PY{k}{with} \PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{sess}\PY{p}{:}
                 \PY{n}{saver}\PY{o}{.}\PY{n}{restore}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{latest\PYZus{}checkpoint}\PY{p}{(}\PY{n}{session\PYZus{}path}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} predict labels for check images}
                 \PY{n}{predictions} \PY{o}{=} \PY{n}{sess}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{logits}\PY{p}{,} \PY{n}{feed\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{x}\PY{p}{:} \PY{n}{checkimages\PYZus{}norm}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{:} \PY{l+m+mf}{1.0}\PY{p}{\PYZcb{}}\PY{p}{)}
                 \PY{n}{checklabelnums\PYZus{}pred} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{predictions}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
                 
             \PY{c+c1}{\PYZsh{} plot check images with predicted labels}
             \PY{n}{checklabels\PYZus{}pred} \PY{o}{=} \PY{p}{[}\PY{n}{labeldict}\PY{p}{[}\PY{n}{checklabelnum\PYZus{}pred}\PY{p}{]} \PY{k}{for} \PY{n}{checklabelnum\PYZus{}pred} \PY{o+ow}{in} \PY{n}{checklabelnums\PYZus{}pred}\PY{p}{]}
             \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{checkimages}\PY{p}{,} \PY{n}{checklabels\PYZus{}pred}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{checkimages}\PY{p}{)}\PY{p}{)}
             
             \PY{k}{return} \PY{n}{checklabelnums\PYZus{}pred}\PY{p}{,} \PY{n}{checklabels\PYZus{}pred}\PY{p}{,} \PY{n}{checkimages\PYZus{}norm}
         
         \PY{n}{ownlabelnums\PYZus{}pred}\PY{p}{,} \PY{n}{ownlabels\PYZus{}pred}\PY{p}{,} \PY{n}{ownimages\PYZus{}norm} \PY{o}{=} \PY{n}{predict\PYZus{}image\PYZus{}labels}\PY{p}{(}\PY{n}{ownimages}\PY{p}{,} \PY{n}{labeldict}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_32_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{Analyze Performance}\label{analyze-performance}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Calculate the accuracy for these 5 new images. }
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} For example, if the model predicted 1 out of 5 signs correctly, it\PYZsq{}s 20\PYZpc{} accurate on these new images.}
         
         \PY{k}{def} \PY{n+nf}{check\PYZus{}accuracy}\PY{p}{(}\PY{n}{checklabelnums}\PY{p}{,} \PY{n}{checklabelnums\PYZus{}pred}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function checks the accuracy of predicted labels}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} checklabelnums      : actual label numbers}
         \PY{c+c1}{\PYZsh{} checklabelnums\PYZus{}pred : predicted label numbers}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} checklabelnums\PYZus{}pred : array of predicted label numbers}
         \PY{c+c1}{\PYZsh{} checklabels\PYZus{}pred    : predicted labels}
             
             \PY{c+c1}{\PYZsh{} calculate percentage of accurately predicted labels of own images}
             \PY{n}{correct\PYZus{}predictions} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{checklabelnums} \PY{o}{==} \PY{n}{checklabelnums\PYZus{}pred}\PY{p}{)}
             \PY{n}{number\PYZus{}images} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{checklabelnums}\PY{p}{)}
             \PY{n}{accuracy} \PY{o}{=} \PY{p}{(}\PY{n}{correct\PYZus{}predictions} \PY{o}{/} \PY{n}{number\PYZus{}images} \PY{o}{*} \PY{l+m+mi}{100}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display result}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{correct\PYZus{}predictions}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{out of}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{number\PYZus{}images}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{own images predicted correctly \PYZhy{} accuracy is}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}:5.1f\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{accuracy}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             
             \PY{k}{return} \PY{n}{accuracy}
         
         \PY{n}{accuracy} \PY{o}{=} \PY{n}{check\PYZus{}accuracy}\PY{p}{(}\PY{n}{ownlabelnums}\PY{p}{,} \PY{n}{ownlabelnums\PYZus{}pred}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
6 out of 6 own images predicted correctly - accuracy is 100.0 \%

    \end{Verbatim}

    \subsubsection{Output Top 5 Softmax Probabilities For Each Image Found
on the
Web}\label{output-top-5-softmax-probabilities-for-each-image-found-on-the-web}

    For each of the new images, print out the model's softmax probabilities
to show the \textbf{certainty} of the model's predictions (limit the
output to the top 5 probabilities for each image).
\href{https://www.tensorflow.org/versions/r0.12/api_docs/python/nn.html\#top_k}{\texttt{tf.nn.top\_k}}
could prove helpful here.

The example below demonstrates how tf.nn.top\_k can be used to find the
top k predictions for each image.

\texttt{tf.nn.top\_k} will return the values and indices (class ids) of
the top k predictions. So if k=3, for each sign, it'll return the 3
largest probabilities (out of a possible 43) and the correspoding class
ids.

Take this numpy array as an example. The values in the array represent
predictions. The array contains softmax probabilities for five candidate
images with six possible classes. \texttt{tf.nn.top\_k} is used to
choose the three classes with the highest probability:

\begin{verbatim}
# (5, 6) array
a = np.array([[ 0.24879643,  0.07032244,  0.12641572,  0.34763842,  0.07893497,
         0.12789202],
       [ 0.28086119,  0.27569815,  0.08594638,  0.0178669 ,  0.18063401,
         0.15899337],
       [ 0.26076848,  0.23664738,  0.08020603,  0.07001922,  0.1134371 ,
         0.23892179],
       [ 0.11943333,  0.29198961,  0.02605103,  0.26234032,  0.1351348 ,
         0.16505091],
       [ 0.09561176,  0.34396535,  0.0643941 ,  0.16240774,  0.24206137,
         0.09155967]])
\end{verbatim}

Running it through \texttt{sess.run(tf.nn.top\_k(tf.constant(a),\ k=3))}
produces:

\begin{verbatim}
TopKV2(values=array([[ 0.34763842,  0.24879643,  0.12789202],
       [ 0.28086119,  0.27569815,  0.18063401],
       [ 0.26076848,  0.23892179,  0.23664738],
       [ 0.29198961,  0.26234032,  0.16505091],
       [ 0.34396535,  0.24206137,  0.16240774]]), indices=array([[3, 0, 5],
       [0, 1, 4],
       [0, 5, 1],
       [1, 3, 5],
       [1, 4, 3]], dtype=int32))
\end{verbatim}

Looking just at the first row we get
\texttt{{[}\ 0.34763842,\ \ 0.24879643,\ \ 0.12789202{]}}, you can
confirm these are the 3 largest probabilities in \texttt{a}. You'll also
notice \texttt{{[}3,\ 0,\ 5{]}} are the corresponding indices.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Print out the top five softmax probabilities for the predictions on the German traffic sign images found on the web. }
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
         
         \PY{k}{def} \PY{n+nf}{evaluate\PYZus{}top\PYZus{}k}\PY{p}{(}\PY{n}{logits}\PY{p}{,} \PY{n}{checkimages}\PY{p}{,} \PY{n}{checkimages\PYZus{}norm}\PY{p}{,} \PY{n}{checklabels}\PY{p}{,} \PY{n}{averageimages}\PY{p}{,} \PY{n}{labels}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function evaluates the top k predicted images for each image to be checked}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} logits           : tensorflow forward propagation pipeline}
         \PY{c+c1}{\PYZsh{} checkimages      : images to be checked}
         \PY{c+c1}{\PYZsh{} checkimages\PYZus{}norm : normalized images to be checked}
         \PY{c+c1}{\PYZsh{} checklabels      : actual label of images to be checked}
         \PY{c+c1}{\PYZsh{} averageimages    : reference images for each label}
         \PY{c+c1}{\PYZsh{} labels           : labels of reference images}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Outputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} checklabelnums\PYZus{}pred : array of predicted label numbers}
         \PY{c+c1}{\PYZsh{} checklabels\PYZus{}pred    : predicted labels}
             
             \PY{c+c1}{\PYZsh{} define constants}
             \PY{n}{session\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/temp\PYZus{}data}\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{k\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{5}
             \PY{n}{horizontalplotsize} \PY{o}{=} \PY{l+m+mi}{3}
             \PY{n}{verticalplotsize} \PY{o}{=} \PY{l+m+mi}{2}
             \PY{n}{dpi} \PY{o}{=} \PY{l+m+mi}{80}
             
             \PY{c+c1}{\PYZsh{} define pipeline}
             \PY{n}{softmax\PYZus{}logits} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{softmax}\PY{p}{(}\PY{n}{logits}\PY{p}{)}
             \PY{n}{top\PYZus{}k} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{top\PYZus{}k}\PY{p}{(}\PY{n}{softmax\PYZus{}logits}\PY{p}{,} \PY{n}{k} \PY{o}{=} \PY{n}{k\PYZus{}size}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} restore trained network}
             \PY{k}{with} \PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{sess}\PY{p}{:}
                 \PY{n}{saver}\PY{o}{.}\PY{n}{restore}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{latest\PYZus{}checkpoint}\PY{p}{(}\PY{n}{session\PYZus{}path}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} determine top k softmax labels for check images}
                 \PY{n}{top\PYZus{}k\PYZus{}pred} \PY{o}{=} \PY{n}{sess}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{top\PYZus{}k}\PY{p}{,} \PY{n}{feed\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{x}\PY{p}{:} \PY{n}{checkimages\PYZus{}norm}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{:} \PY{l+m+mf}{1.0}\PY{p}{\PYZcb{}}\PY{p}{)}
                 
             \PY{c+c1}{\PYZsh{} get all predicted labels and percentages}
             \PY{n}{top\PYZus{}k} \PY{o}{=} \PY{n}{top\PYZus{}k\PYZus{}pred}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{top\PYZus{}k\PYZus{}percentages} \PY{o}{=} \PY{n}{top\PYZus{}k\PYZus{}pred}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} loop through check images}
             \PY{k}{for} \PY{n}{idx1}\PY{p}{,} \PY{n}{checkimage} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{checkimages}\PY{p}{)}\PY{p}{:}
             
                 \PY{c+c1}{\PYZsh{} initialize variables}
                 \PY{n}{topkimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{n}{topklabels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} add check image to result}
                 \PY{n}{topkimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{checkimage}\PY{p}{)}
                 \PY{n}{topklabels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Original: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{checklabels}\PY{p}{[}\PY{n}{idx1}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} loop through top k prediction for current image}
                 \PY{k}{for} \PY{n}{idx2}\PY{p}{,} \PY{n}{k} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{top\PYZus{}k}\PY{p}{[}\PY{n}{idx1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} add top k image to result}
                     \PY{n}{topkimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{averageimages}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{)}
                     \PY{n}{topklabels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Top }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{idx2} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{labels}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} plot check image with top k predictions}
                 \PY{n}{topkimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{topkimages}\PY{p}{)}
                 \PY{n}{topklabels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{topklabels}\PY{p}{)}
                 \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{topkimages}\PY{p}{,} \PY{n}{topklabels}\PY{p}{,} \PY{p}{(}\PY{n}{k\PYZus{}size} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} plot prediction percentage for top k predictions}
                 \PY{n}{plotfigure}\PY{p}{,} \PY{n}{plotaxes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{n}{horizontalplotsize}\PY{p}{,} \PY{n}{verticalplotsize}\PY{p}{)}\PY{p}{,} \PY{n}{dpi} \PY{o}{=} \PY{n}{dpi}\PY{p}{)}
                 \PY{n}{plotfigure}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
                 \PY{n}{plotaxes}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{tick\PYZus{}right}\PY{p}{(}\PY{p}{)}
                 \PY{n}{plotaxes}\PY{o}{.}\PY{n}{barh}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{flip}\PY{p}{(}\PY{n}{topklabels}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{flip}\PY{p}{(}\PY{n}{top\PYZus{}k\PYZus{}percentages}\PY{p}{[}\PY{n}{idx1}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{black}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{n}{evaluate\PYZus{}top\PYZus{}k}\PY{p}{(}\PY{n}{logits}\PY{p}{,} \PY{n}{ownimages}\PY{p}{,} \PY{n}{ownimages\PYZus{}norm}\PY{p}{,} \PY{n}{ownlabels}\PY{p}{,} \PY{n}{averageimages}\PY{p}{,} \PY{n}{labels}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_6.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_8.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_9.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_10.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_11.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_37_12.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{Project Writeup}\label{project-writeup}

Once you have completed the code implementation, document your results
in a project writeup using this
\href{https://github.com/udacity/CarND-Traffic-Sign-Classifier-Project/blob/master/writeup_template.md}{template}
as a guide. The writeup can be in a markdown or pdf file.

    \begin{quote}
\textbf{Note}: Once you have completed all of the code implementations
and successfully answered each question above, you may finalize your
work by exporting the iPython Notebook as an HTML document. You can do
this by using the menu above and navigating to \n", "\textbf{File
-\textgreater{} Download as -\textgreater{} HTML (.html)}. Include the
finished document along with this notebook as your submission.
\end{quote}

    \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Step 4 (Optional): Visualize the Neural Network's State with
Test
Images}\label{step-4-optional-visualize-the-neural-networks-state-with-test-images}

This Section is not required to complete but acts as an additional
excersise for understaning the output of a neural network's weights.
While neural networks can be a great learning device they are often
referred to as a black box. We can understand what the weights of a
neural network look like better by plotting their feature maps. After
successfully training your neural network you can see what it's feature
maps look like by plotting the output of the network's weight layers in
response to a test stimuli image. From these plotted feature maps, it's
possible to see what characteristics of an image the network finds
interesting. For a sign, maybe the inner network feature maps react with
high activation to the sign's boundary outline or to the contrast in the
sign's painted symbol.

Provided for you below is the function code that allows you to get the
visualization output of any tensorflow weight layer you want. The inputs
to the function should be a stimuli image, one used during training or a
new one you provided, and then the tensorflow variable name that
represents the layer's state during the training process, for instance
if you wanted to see what the
\href{https://classroom.udacity.com/nanodegrees/nd013/parts/fbf77062-5703-404e-b60c-95b78b2f3f9e/modules/6df7ae49-c61c-4bb2-a23e-6527e69209ec/lessons/601ae704-1035-4287-8b11-e2c2716217ad/concepts/d4aca031-508f-4e0b-b493-e7b706120f81}{LeNet
lab's} feature maps looked like for it's second convolutional layer you
could enter conv2 as the tf\_activation variable.

For an example of what feature map outputs look like, check out NVIDIA's
results in their paper
\href{https://devblogs.nvidia.com/parallelforall/deep-learning-self-driving-cars/}{End-to-End
Deep Learning for Self-Driving Cars} in the section Visualization of
internal CNN State. NVIDIA was able to show that their network's inner
weights had high activations to road boundary lines by comparing feature
maps from an image with a clear path to one without. Try experimenting
with a similar test to show that your trained network's weights are
looking for interesting features, whether it's looking at differences in
feature maps from images with or without a sign, or even what feature
maps look like in a trained network vs a completely untrained one on the
same sign image.

Your output should look something like this (above)

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Visualize your network\PYZsq{}s feature maps here.}
         \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Feel free to use as many code cells as needed.}
         
         \PY{c+c1}{\PYZsh{} image\PYZus{}input: the test image being fed into the network to produce the feature maps}
         \PY{c+c1}{\PYZsh{} tf\PYZus{}activation: should be a tf variable name used during your training procedure that represents the calculated state of a specific weight layer}
         \PY{c+c1}{\PYZsh{} activation\PYZus{}min/max: can be used to view the activation contrast in more detail, by default matplot sets min and max to the actual min and max values of the output}
         \PY{c+c1}{\PYZsh{} plt\PYZus{}num: used to plot out multiple different weight feature map sets on the same block, just extend the plt number for each new feature map entry}
         
         \PY{k}{def} \PY{n+nf}{outputFeatureMap}\PY{p}{(}\PY{n}{session}\PY{p}{,} \PY{n}{image\PYZus{}input}\PY{p}{,} \PY{n}{tf\PYZus{}activation}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} Here make sure to preprocess your image\PYZus{}input in a way your network expects}
             \PY{c+c1}{\PYZsh{} with size, normalization, ect if needed}
             \PY{c+c1}{\PYZsh{} image\PYZus{}input =}
             \PY{c+c1}{\PYZsh{} Note: x should be the same name as your network\PYZsq{}s tensorflow data placeholder variable}
             \PY{c+c1}{\PYZsh{} If you get an error tf\PYZus{}activation is not defined it may be having trouble accessing the variable from inside a function}
             
             \PY{c+c1}{\PYZsh{} define constants}
             \PY{n}{featuretext} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Feature map }\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{channeltext} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ channel }\PY{l+s+s1}{\PYZsq{}}
             \PY{c+c1}{\PYZsh{}interpolation = \PYZsq{}nearest\PYZsq{}}
             \PY{n}{interpolation} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bilinear}\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{maximages} \PY{o}{=} \PY{l+m+mi}{250}
             
             \PY{c+c1}{\PYZsh{} retrieve weight matrix}
             \PY{n}{activation} \PY{o}{=} \PY{n}{session}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{tf\PYZus{}activation}\PY{p}{,} \PY{n}{feed\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{x} \PY{p}{:} \PY{p}{[}\PY{n}{image\PYZus{}input}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} gather information about dimensions}
             \PY{n}{featuremaps} \PY{o}{=} \PY{n}{activation}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}
             \PY{n}{colormaps} \PY{o}{=} \PY{n}{activation}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} initialize variables}
             \PY{n}{featureimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{featurelabels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             
             \PY{c+c1}{\PYZsh{} plot all feature maps}
             \PY{k}{for} \PY{n}{featuremap} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{featuremaps}\PY{p}{)}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} layer has color input}
                 \PY{k}{if} \PY{p}{(}\PY{n}{colormaps} \PY{o}{==} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} do not define color map}
                     \PY{n}{cmap} \PY{o}{=} \PY{k+kc}{None}
                     
                     \PY{c+c1}{\PYZsh{} save current feature map as color image}
                     \PY{n}{featureimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{activation}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{n}{featuremap}\PY{p}{]}\PY{p}{)}
                     \PY{n}{featurelabels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{featuretext} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{featuremap}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} layer has no color input}
                 \PY{k}{else}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} select grayscale color map}
                     \PY{n}{cmap} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}
                     
                     \PY{c+c1}{\PYZsh{} save all channels}
                     \PY{k}{for} \PY{n}{channel} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{colormaps}\PY{p}{)}\PY{p}{:}
                         
                         \PY{c+c1}{\PYZsh{} save feature map as image}
                         \PY{n}{featureimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{activation}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{n}{channel}\PY{p}{,} \PY{n}{featuremap}\PY{p}{]}\PY{p}{)}
                         \PY{n}{featurelabels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{featuretext} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{featuremap}\PY{p}{)} \PY{o}{+} \PY{n}{channeltext} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{channel}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} convert feature images and labels to arrays}
             \PY{n}{featureimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{featureimages}\PY{p}{)}
             \PY{n}{featurelabels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{featurelabels}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} normalize feature images}
             \PY{n}{featureimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{255} \PY{o}{*} \PY{p}{(}\PY{p}{(}\PY{n}{featureimages} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{featureimages}\PY{p}{)}\PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{featureimages}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{featureimages}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display feature images}
             \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{featureimages}\PY{p}{,} \PY{n}{featurelabels}\PY{p}{,} \PY{n+nb}{min}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{featurelabels}\PY{p}{)}\PY{p}{,} \PY{n}{maximages}\PY{p}{)}\PY{p}{,} \PY{n}{interpolation} \PY{o}{=} \PY{n}{interpolation}\PY{p}{,} \PY{n}{cmap} \PY{o}{=} \PY{n}{cmap}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{c+c1}{\PYZsh{} define constants}
         \PY{n}{probe\PYZus{}num} \PY{o}{=} \PY{l+m+mi}{14}
         
         \PY{c+c1}{\PYZsh{} define image to probe convolutional layers}
         \PY{n}{probe\PYZus{}image} \PY{o}{=} \PY{n}{averageimages}\PY{p}{[}\PY{n}{probe\PYZus{}num}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Image used to probe convolutional layers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{probe\PYZus{}image}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{[}\PY{n}{labels}\PY{p}{[}\PY{n}{probe\PYZus{}num}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} retrieve activation variables}
         \PY{n}{conv1\PYZus{}W}\PY{p}{,} \PY{n}{conv2\PYZus{}W} \PY{o}{=} \PY{n}{conv\PYZus{}Ws}
         
         \PY{c+c1}{\PYZsh{} restore trained network}
         \PY{k}{with} \PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{sess}\PY{p}{:}
             \PY{n}{saver}\PY{o}{.}\PY{n}{restore}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{latest\PYZus{}checkpoint}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/temp\PYZus{}data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display first layer}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{First convolutional layer}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{outputFeatureMap}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{probe\PYZus{}image}\PY{p}{,} \PY{n}{conv1\PYZus{}W}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display second layer}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Second convolutional layer}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{outputFeatureMap}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{probe\PYZus{}image}\PY{p}{,} \PY{n}{conv2\PYZus{}W}\PY{p}{)}    
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Image used to probe convolutional layers

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_42_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass
First convolutional layer

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_42_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Second convolutional layer

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_42_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Fun with unknown traffic
signs}\label{fun-with-unknown-traffic-signs}

    Predicting images that should be predicted is one thing. It's more fun
to try to predict images that shouldn't be predicted - let's say US
traffic signs ;-)

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}26}]:} \PY{c+c1}{\PYZsh{} define constants}
         \PY{n}{subfolder} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wrong}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{imagemask} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{*.jpg}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{wronglabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Untrained traffic sign}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{wronglabelnums} \PY{o}{=} \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
         
         \PY{n}{wrongimages}\PY{p}{,} \PY{n}{wronglabels} \PY{o}{=} \PY{n}{load\PYZus{}images}\PY{p}{(}\PY{n}{subfolder}\PY{p}{,} \PY{n}{imagemask}\PY{p}{,} \PY{n}{wronglabelnums}\PY{p}{,} \PY{n}{labeldict}\PY{p}{,} \PY{n}{wronglabel}\PY{p}{)}
         \PY{n}{wronglabelnums\PYZus{}pred}\PY{p}{,} \PY{n}{wronglabels\PYZus{}pred}\PY{p}{,} \PY{n}{wrongimages\PYZus{}norm} \PY{o}{=} \PY{n}{predict\PYZus{}image\PYZus{}labels}\PY{p}{(}\PY{n}{wrongimages}\PY{p}{,} \PY{n}{labeldict}\PY{p}{)}
         \PY{n}{accuracy} \PY{o}{=} \PY{n}{check\PYZus{}accuracy}\PY{p}{(}\PY{n}{wronglabelnums}\PY{p}{,} \PY{n}{wronglabelnums\PYZus{}pred}\PY{p}{)}
         \PY{n}{evaluate\PYZus{}top\PYZus{}k}\PY{p}{(}\PY{n}{logits}\PY{p}{,} \PY{n}{wrongimages}\PY{p}{,} \PY{n}{wrongimages\PYZus{}norm}\PY{p}{,} \PY{n}{wronglabels}\PY{p}{,} \PY{n}{averageimages}\PY{p}{,} \PY{n}{labels}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
0 out of 6 own images predicted correctly - accuracy is   0.0 \%
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_6.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_8.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_9.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_10.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_11.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_12.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_13.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_14.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_45_15.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Searching within larger
pictures}\label{searching-within-larger-pictures}

    As you normally cannot expect to know where in a picture traffic signs
occur, we need an algorithm that searches for traffic signs within a
larger picture.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}36}]:} \PY{c+c1}{\PYZsh{} define constants}
         \PY{n}{largesubfolder} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{large}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{largeimagemask} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{*.jpg}\PY{l+s+s1}{\PYZsq{}}
         
         \PY{k}{def} \PY{n+nf}{check\PYZus{}large\PYZus{}images}\PY{p}{(}\PY{n}{subfolder}\PY{p}{,} \PY{n}{imagemask}\PY{p}{,} \PY{n}{referenceimages}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{bdisplay} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} \PY{n}{bdisplaydeep} \PY{o}{=} \PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} This function checks a large image for traffic signs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} Inputs}
         \PY{c+c1}{\PYZsh{} ...}
         \PY{c+c1}{\PYZsh{} subfolder       : subfolder with large images to be checked}
         \PY{c+c1}{\PYZsh{} imagemask       : file name mask for large images to be checked}
         \PY{c+c1}{\PYZsh{} referenceimages : reference images for labels}
         \PY{c+c1}{\PYZsh{} labels          : traffic sign labels}
         \PY{c+c1}{\PYZsh{} bdisplay        : boolean for \PYZsq{}display information\PYZsq{}}
         \PY{c+c1}{\PYZsh{} bdisplaydeep    : boolean for \PYZsq{}display deep information\PYZsq{}}
             
             \PY{c+c1}{\PYZsh{} define constants}
             \PY{n}{session\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{../../GD\PYZus{}GitHubData/temp\PYZus{}data}\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{k\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{9}
             \PY{n}{base\PYZus{}scale} \PY{o}{=} \PY{l+m+mi}{32}
             \PY{n}{max\PYZus{}scale} \PY{o}{=} \PY{l+m+mi}{320}\PY{o}{/}\PY{l+m+mi}{10}\PY{o}{*}\PY{l+m+mi}{4}
             \PY{n}{stride} \PY{o}{=} \PY{l+m+mi}{5}
             \PY{n}{horizontalplotsize} \PY{o}{=} \PY{l+m+mi}{3}
             \PY{n}{verticalplotsize} \PY{o}{=} \PY{l+m+mi}{2}\PY{o}{/}\PY{l+m+mi}{5}\PY{o}{*}\PY{n}{k\PYZus{}size}
             \PY{n}{dpi} \PY{o}{=} \PY{l+m+mi}{80}
             
             \PY{c+c1}{\PYZsh{} define pipeline}
             \PY{n}{softmax\PYZus{}logits} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{softmax}\PY{p}{(}\PY{n}{logits}\PY{p}{)}
             \PY{n}{top\PYZus{}k} \PY{o}{=} \PY{n}{tf}\PY{o}{.}\PY{n}{nn}\PY{o}{.}\PY{n}{top\PYZus{}k}\PY{p}{(}\PY{n}{softmax\PYZus{}logits}\PY{p}{,} \PY{n}{k} \PY{o}{=} \PY{n}{k\PYZus{}size}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} define scales on which to check large images}
             \PY{n}{scales} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{(}\PY{n}{base\PYZus{}scale} \PY{o}{*} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{flip}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{floor}\PY{p}{(}\PY{n}{max\PYZus{}scale} \PY{o}{/} \PY{n}{base\PYZus{}scale}\PY{p}{)}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} display information}
             \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scales}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{scales}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} get path to images}
             \PY{n}{fileimages} \PY{o}{=} \PY{n}{glob}\PY{o}{.}\PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{subfolder}\PY{p}{,} \PY{n}{imagemask}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} initialize variables}
             \PY{n}{largeimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 
             \PY{c+c1}{\PYZsh{} loop through large image file names}
             \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{fileimage} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{fileimages}\PY{p}{)}\PY{p}{:}
                     
                 \PY{c+c1}{\PYZsh{} read large image}
                 \PY{n}{largeimage} \PY{o}{=} \PY{n}{im}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{n}{fileimage}\PY{p}{)}
                 \PY{n}{largeimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{largeimage}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} loop through large images}
             \PY{k}{for} \PY{n}{largeimage} \PY{o+ow}{in} \PY{p}{[}\PY{n}{largeimages}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{]}\PY{p}{:}
                 
                 \PY{c+c1}{\PYZsh{} plot current image}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Processing the following image...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{largeimage}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} initialize array for all check images}
                 \PY{n}{image\PYZus{}sections} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} check large image on each scale}
                 \PY{k}{for} \PY{n}{scale} \PY{o+ow}{in} \PY{n}{scales}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} scale image}
                     \PY{n}{image\PYZus{}shape} \PY{o}{=} \PY{n}{largeimage}\PY{o}{.}\PY{n}{size}
                     \PY{n}{new\PYZus{}height} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{(}\PY{p}{(}\PY{n}{image\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{/} \PY{n}{image\PYZus{}shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{*} \PY{n}{scale}\PY{p}{)}
                     \PY{n}{scaledimage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{largeimage}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{p}{(}\PY{n}{scale}\PY{p}{,} \PY{n}{new\PYZus{}height}\PY{p}{)}\PY{p}{,} \PY{n}{im}\PY{o}{.}\PY{n}{ANTIALIAS}\PY{p}{)}\PY{p}{)}
                     
                     \PY{c+c1}{\PYZsh{} get number of steps in scaled image}
                     \PY{n}{xoffsets} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{p}{(}\PY{n}{scale} \PY{o}{\PYZhy{}} \PY{n}{base\PYZus{}scale} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{n}{stride}\PY{p}{)}\PY{p}{)}
                     \PY{n}{yoffsets} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{p}{(}\PY{n}{new\PYZus{}height} \PY{o}{\PYZhy{}} \PY{n}{base\PYZus{}scale} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{n}{stride}\PY{p}{)}\PY{p}{)}
                     
                     \PY{c+c1}{\PYZsh{} all steps valid}
                     \PY{k}{if} \PY{p}{(}\PY{p}{(}\PY{n}{xoffsets} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{yoffsets} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                         
                         \PY{c+c1}{\PYZsh{} display information}
                         \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scale}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{scale}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{: Xoffsets}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{xoffsets}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Yoffsets}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{yoffsets}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{scaledimage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
                         
                         \PY{c+c1}{\PYZsh{} iterate through all steps}
                         \PY{k}{for} \PY{n}{yoffset} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{yoffsets}\PY{p}{)}\PY{p}{:}
                             \PY{k}{for} \PY{n}{xoffset} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{xoffsets}\PY{p}{)}\PY{p}{:}
                                 
                                 \PY{c+c1}{\PYZsh{} get image section}
                                 \PY{n}{xstart} \PY{o}{=} \PY{p}{(}\PY{n}{xoffset} \PY{o}{*} \PY{n}{stride}\PY{p}{)}
                                 \PY{n}{xend} \PY{o}{=} \PY{p}{(}\PY{n}{xoffset} \PY{o}{*} \PY{n}{stride}\PY{p}{)} \PY{o}{+} \PY{n}{base\PYZus{}scale}
                                 \PY{n}{ystart} \PY{o}{=} \PY{p}{(}\PY{n}{yoffset} \PY{o}{*} \PY{n}{stride}\PY{p}{)}
                                 \PY{n}{yend} \PY{o}{=} \PY{p}{(}\PY{n}{yoffset} \PY{o}{*} \PY{n}{stride}\PY{p}{)} \PY{o}{+} \PY{n}{base\PYZus{}scale}
                                 \PY{n}{image\PYZus{}section} \PY{o}{=} \PY{n}{scaledimage}\PY{p}{[}\PY{n}{ystart}\PY{p}{:}\PY{n}{yend}\PY{p}{,} \PY{n}{xstart}\PY{p}{:}\PY{n}{xend}\PY{p}{]}
                                 \PY{n}{image\PYZus{}sections}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image\PYZus{}section}\PY{p}{)}
                                 
                                 \PY{c+c1}{\PYZsh{} display information}
                                 \PY{k}{if} \PY{p}{(}\PY{n}{bdisplay} \PY{o}{\PYZam{}} \PY{n}{bdisplaydeep}\PY{p}{)}\PY{p}{:}
                                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Xstart}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{xstart}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ystart}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ystart}\PY{p}{)}
                                     \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}section}\PY{p}{)}
                                     \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} normalize input data}
                 \PY{n}{image\PYZus{}sections} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{image\PYZus{}sections}\PY{p}{)}
                 \PY{n}{image\PYZus{}sections\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{image\PYZus{}sections} \PY{o}{/} \PY{l+m+mf}{127.5}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} determine top k softmax labels for check images}
                 \PY{k}{with} \PY{n}{tf}\PY{o}{.}\PY{n}{Session}\PY{p}{(}\PY{p}{)} \PY{k}{as} \PY{n}{sess}\PY{p}{:}
                     \PY{n}{saver}\PY{o}{.}\PY{n}{restore}\PY{p}{(}\PY{n}{sess}\PY{p}{,} \PY{n}{tf}\PY{o}{.}\PY{n}{train}\PY{o}{.}\PY{n}{latest\PYZus{}checkpoint}\PY{p}{(}\PY{n}{session\PYZus{}path}\PY{p}{)}\PY{p}{)}
                     \PY{n}{top\PYZus{}k\PYZus{}pred} \PY{o}{=} \PY{n}{sess}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{n}{top\PYZus{}k}\PY{p}{,} \PY{n}{feed\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{x}\PY{p}{:} \PY{n}{image\PYZus{}sections\PYZus{}norm}\PY{p}{,} \PY{n}{tf\PYZus{}keep\PYZus{}prob}\PY{p}{:} \PY{l+m+mf}{1.0}\PY{p}{\PYZcb{}}\PY{p}{)}
                                 
                 \PY{c+c1}{\PYZsh{} get all predicted labels and percentages}
                 \PY{n}{all\PYZus{}top\PYZus{}ks} \PY{o}{=} \PY{n}{top\PYZus{}k\PYZus{}pred}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
                 \PY{n}{top\PYZus{}ks} \PY{o}{=} \PY{n}{all\PYZus{}top\PYZus{}ks}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{all\PYZus{}top\PYZus{}k\PYZus{}percentages} \PY{o}{=} \PY{n}{top\PYZus{}k\PYZus{}pred}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                 \PY{n}{top\PYZus{}k\PYZus{}percentages} \PY{o}{=} \PY{n}{all\PYZus{}top\PYZus{}k\PYZus{}percentages}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} sort by percentage}
                 \PY{n}{args\PYZus{}top\PYZus{}k\PYZus{}percentages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{flip}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{argsort}\PY{p}{(}\PY{n}{top\PYZus{}k\PYZus{}percentages}\PY{p}{)}\PY{p}{)}
                 \PY{n}{top\PYZus{}ks\PYZus{}sorted} \PY{o}{=} \PY{n}{top\PYZus{}ks}\PY{p}{[}\PY{n}{args\PYZus{}top\PYZus{}k\PYZus{}percentages}\PY{p}{]}
                 \PY{n}{top\PYZus{}k\PYZus{}percentages\PYZus{}sorted} \PY{o}{=} \PY{n}{top\PYZus{}k\PYZus{}percentages}\PY{p}{[}\PY{n}{args\PYZus{}top\PYZus{}k\PYZus{}percentages}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} remove double entries}
                 \PY{n}{top\PYZus{}label\PYZus{}nums} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{n}{top\PYZus{}label\PYZus{}percentages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{top\PYZus{}k} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{top\PYZus{}ks\PYZus{}sorted}\PY{p}{)}\PY{p}{:}
                     \PY{k}{if} \PY{o+ow}{not} \PY{n}{top\PYZus{}k} \PY{o+ow}{in} \PY{n}{top\PYZus{}label\PYZus{}nums}\PY{p}{:}
                         \PY{n}{top\PYZus{}label\PYZus{}nums}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{top\PYZus{}k}\PY{p}{)}
                         \PY{n}{top\PYZus{}label\PYZus{}percentages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{top\PYZus{}k\PYZus{}percentages\PYZus{}sorted}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} display information}
                 \PY{k}{if} \PY{n}{bdisplay}\PY{p}{:}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Top labels}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{top\PYZus{}label\PYZus{}nums}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Top percentages}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{top\PYZus{}label\PYZus{}percentages}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} continue with the top k\PYZus{}size items}
                 \PY{n}{top\PYZus{}label\PYZus{}nums\PYZus{}limited} \PY{o}{=} \PY{n}{top\PYZus{}label\PYZus{}nums}\PY{p}{[}\PY{p}{:}\PY{n}{k\PYZus{}size}\PY{p}{]}
                 \PY{n}{top\PYZus{}label\PYZus{}percentages\PYZus{}limited} \PY{o}{=} \PY{n}{top\PYZus{}label\PYZus{}percentages}\PY{p}{[}\PY{p}{:}\PY{n}{k\PYZus{}size}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} initialize variables}
                 \PY{n}{topkimages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{n}{topklabels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 
                 \PY{c+c1}{\PYZsh{} loop through top predictions for current image}
                 \PY{k}{for} \PY{n}{idx}\PY{p}{,} \PY{n}{top\PYZus{}label\PYZus{}num} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{top\PYZus{}label\PYZus{}nums\PYZus{}limited}\PY{p}{)}\PY{p}{:}
                     
                     \PY{c+c1}{\PYZsh{} add top image to result}
                     \PY{n}{topkimages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{referenceimages}\PY{p}{[}\PY{n}{top\PYZus{}label\PYZus{}num}\PY{p}{]}\PY{p}{)}
                     \PY{n}{topklabels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Top }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{idx} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{labels}\PY{p}{[}\PY{n}{top\PYZus{}label\PYZus{}num}\PY{p}{]}\PY{p}{)}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} plot original image with top k predictions}
                 \PY{n}{topkimages} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{topkimages}\PY{p}{)}
                 \PY{n}{topklabels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{topklabels}\PY{p}{)}
                 \PY{n}{plot\PYZus{}traffic\PYZus{}signs}\PY{p}{(}\PY{n}{topkimages}\PY{p}{,} \PY{n}{topklabels}\PY{p}{,} \PY{n}{k\PYZus{}size}\PY{p}{)}
                 
                 \PY{c+c1}{\PYZsh{} plot prediction percentage for top k predictions}
                 \PY{n}{plotfigure}\PY{p}{,} \PY{n}{plotaxes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{n}{horizontalplotsize}\PY{p}{,} \PY{n}{verticalplotsize}\PY{p}{)}\PY{p}{,} \PY{n}{dpi} \PY{o}{=} \PY{n}{dpi}\PY{p}{)}
                 \PY{n}{plotfigure}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
                 \PY{n}{plotaxes}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{tick\PYZus{}right}\PY{p}{(}\PY{p}{)}
                 \PY{n}{plotaxes}\PY{o}{.}\PY{n}{barh}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{flip}\PY{p}{(}\PY{n}{topklabels}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{flip}\PY{p}{(}\PY{n}{top\PYZus{}label\PYZus{}percentages\PYZus{}limited}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{black}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         
         \PY{n}{check\PYZus{}large\PYZus{}images}\PY{p}{(}\PY{n}{largesubfolder}\PY{p}{,} \PY{n}{largeimagemask}\PY{p}{,} \PY{n}{averageimages}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{bdisplay} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} \PY{n}{bdisplaydeep} \PY{o}{=} \PY{k+kc}{False}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Processing the following image{\ldots}

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_48_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
INFO:tensorflow:Restoring parameters from ../../GD\_GitHubData/temp\_data\textbackslash{}tsclass

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_48_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_48_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    

    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
